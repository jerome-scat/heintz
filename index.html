<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heintz Dashboard V3 ‚Äî Contr√¥le de Gestion</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prop-types/15.8.1/prop-types.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/recharts@2.5.0/umd/Recharts.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- GoatCounter analytics ‚Äî gratuit, sans cookies, RGPD-friendly -->
    <script data-goatcounter="https://jerome.goatcounter.com/count"
            async src="//gc.zgo.at/count.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config={theme:{extend:{colors:{primary:'#1e3a5f',secondary:'#d4a853',success:'#10b981',warning:'#f59e0b',danger:'#ef4444',surface:'#f8fafc',muted:'#64748b'},fontFamily:{sans:['Inter','sans-serif']}}}}
    </script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Inter',sans-serif;background:#f1f5f9}
        .gradient-header{background:linear-gradient(135deg,#1e3a5f 0%,#2d5a8e 100%)}
        .kpi-card{transition:all .2s ease}.kpi-card:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(30,58,95,.15)}
        .nav-tab{transition:all .2s ease}.nav-tab:hover{background:rgba(30,58,95,.08)}
        .nav-tab.active{color:#1e3a5f;border-bottom:3px solid #d4a853;font-weight:600}
        .hotel-card{transition:all .2s ease;cursor:pointer}.hotel-card:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(0,0,0,.1)}
        .status-badge{display:inline-flex;align-items:center;padding:2px 10px;border-radius:9999px;font-size:.75rem;font-weight:600}
        .leaflet-container{border-radius:.75rem;z-index:1}
        .progress-bar{transition:width .5s ease}
        .org-node{transition:all .2s ease}.org-node:hover{transform:scale(1.03);box-shadow:0 4px 15px rgba(0,0,0,.1)}
        .heatmap-cell{border-radius:4px;transition:all .15s ease}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
        .live-dot{animation:pulse 2s infinite;width:8px;height:8px;border-radius:50%;background:#10b981;display:inline-block}
        .slide-enter{animation:slideIn .3s ease}
        @keyframes slideIn{from{opacity:0;transform:translateX(20px)}to{opacity:1;transform:none}}
        ::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:#f1f5f9}::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px}
        @media(max-width:768px){.nav-scroll{overflow-x:auto;-webkit-overflow-scrolling:touch}.nav-scroll::-webkit-scrollbar{display:none}}
        @media print{.no-print{display:none!important}}
        .sim-slider{-webkit-appearance:none;height:6px;border-radius:3px;background:#e2e8f0;outline:none;width:100%}
        .sim-slider::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;border-radius:50%;background:#1e3a5f;cursor:pointer}
        .side-panel{position:fixed;top:0;right:-440px;width:440px;max-width:92vw;height:100vh;background:white;z-index:1000;box-shadow:-4px 0 25px rgba(0,0,0,.2);transition:right .3s ease;overflow-y:auto}
        .side-panel.open{right:0}
        .side-overlay{position:fixed;inset:0;background:rgba(0,0,0,.4);z-index:999;opacity:0;pointer-events:none;transition:opacity .3s ease}
        .side-overlay.open{opacity:1;pointer-events:auto}
    </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect,useRef,useMemo,useCallback}=React;
const {ResponsiveContainer,ComposedChart,Bar,Line,Area,AreaChart,XAxis,YAxis,CartesianGrid,Tooltip,Legend,PieChart,Pie,Cell,BarChart,ReferenceLine}=Recharts;

// ========== SEASONALITY Grand Est ==========
const SEASON={
    monthly:[{m:"Jan",c:0.72,l:"Creux hivernal"},{m:"F√©v",c:0.75,l:"Hiver, vac. zone B"},{m:"Mar",c:0.85,l:"Reprise printani√®re"},{m:"Avr",c:0.93,l:"P√¢ques, ponts"},{m:"Mai",c:1.02,l:"Ponts mai"},{m:"Jun",c:1.15,l:"D√©but √©t√©"},{m:"Jul",c:1.22,l:"Pic estival"},{m:"Ao√ª",c:1.18,l:"√ât√©"},{m:"Sep",c:1.08,l:"Rentr√©e, Foire Metz"},{m:"Oct",c:0.95,l:"Automne"},{m:"Nov",c:0.78,l:"Creux automnal"},{m:"D√©c",c:1.07,l:"March√©s de No√´l +15%"}],
    weekly:[{j:"Lun",c:0.85},{j:"Mar",c:1.15},{j:"Mer",c:1.20},{j:"Jeu",c:1.12},{j:"Ven",c:1.05},{j:"Sam",c:0.82},{j:"Dim",c:0.62}]
};


// ========== √âV√âNEMENTS Grand Est ==========
const EVENTS=[
    {m:1,nom:"Creux hivernal",impact:-5,type:"saison",ico:"‚ùÑÔ∏è"},
    {m:2,nom:"Vacances zone B",impact:3,type:"vacances",ico:"üéø"},
    {m:3,nom:"Reprise printani√®re",impact:2,type:"saison",ico:"üå±"},
    {m:4,nom:"P√¢ques & ponts",impact:5,type:"f√©ri√©",ico:"üê£"},
    {m:5,nom:"Ascension ¬∑ Pentec√¥te",impact:8,type:"f√©ri√©",ico:"üå∑"},
    {m:6,nom:"Festival Constellations Metz",impact:5,type:"culture",ico:"‚ú®"},
    {m:7,nom:"Pic estival ¬∑ 14 Juillet",impact:10,type:"tourisme",ico:"‚òÄÔ∏è"},
    {m:8,nom:"Mirabelle de Metz ¬∑ 15 Ao√ªt",impact:8,type:"culture",ico:"üçë"},
    {m:9,nom:"Foire Int. Metz ¬∑ Foire Ch√¢lons",impact:12,type:"foire",ico:"üé™"},
    {m:10,nom:"Nancy Jazz Pulsations",impact:3,type:"culture",ico:"üé∑"},
    {m:11,nom:"D√©but March√©s de No√´l",impact:5,type:"tourisme",ico:"üéÑ"},
    {m:12,nom:"March√©s de No√´l Metz ¬∑ Strasbourg ¬∑ Saint-Nicolas",impact:15,type:"tourisme",ico:"üéÖ"}
];

// ========== HOTELS ‚Äî Donn√©es r√©elles plaquette 10/10/2025 ==========
const H=[
    {id:1,n:"Ibis Styles Ch√¢lons",v:"Ch√¢lons-en-Champagne",lat:48.9567,lng:4.3634,ch:70,e:3,ca:2250,caM:0,prop:"Murs et fonds",acq:"Ouverture ao√ªt 2017",reno:"‚Äî",lab:["Clef Verte"],ens:"Accor",fr:"Ibis Styles",to:76,adr:112,rp:85.1,gp:31.2,cc:62,dir:"Antoine Richard",tel:"03 26 65 60 60",eq:["PDJ inclus","Bar","Parking","Wifi","S√©minaires"]},
    {id:2,n:"Ibis Budget Forbach",v:"Forbach",lat:49.1845,lng:6.9012,ch:71,e:2,ca:700,caM:0,prop:"Fonds acquis 2017",acq:"R√©ouverture oct. 2022",reno:"R√©no compl√®te 2017-2022",lab:["Clef Verte"],ens:"Accor",fr:"Ibis Budget",to:61,adr:44,rp:26.8,gp:10.2,cc:32,dir:"Yannick Weber",tel:"08 92 68 09 17",eq:["Parking","Wifi"]},
    {id:3,n:"B&B Thionville",v:"Thionville",lat:49.3567,lng:6.1678,ch:76,e:3,ca:1500,caM:0,prop:"Murs et fonds",acq:"Ouverture jan. 2021",reno:"Construit jan. 2020",lab:["Accueil V√©lo"],ens:"B&B Hotels",fr:"B&B",to:70,adr:77,rp:53.9,gp:19.4,cc:45,dir:"Julie Renard",tel:"08 92 78 29 29",eq:["Parking","Wifi","PDJ buffet"]},
    {id:4,n:"Ibis Styles Sarrebourg",v:"Sarrebourg",lat:48.7345,lng:7.0534,ch:48,e:3,ca:1080,caM:0,prop:"Murs et fonds",acq:"Acquisition juil. 2013",reno:"2013-14 / 2023",lab:["Clef Verte","Accueil V√©lo"],ens:"Accor",fr:"Ibis Styles",to:68,adr:91,rp:61.9,gp:22.5,cc:52,dir:"Fran√ßois Muller",tel:"03 87 03 55 55",eq:["PDJ inclus","Parking","Wifi"]},
    {id:5,n:"Premi√®re Classe Jouy",v:"Jouy-aux-Arches",lat:49.0623,lng:6.0756,ch:71,e:1,ca:620,caM:620,prop:"Murs et fonds",acq:"Acquisition mars 2022",reno:"‚Äî",lab:["Clef Verte","Accueil V√©lo"],ens:"Louvre Hotels",fr:"Premi√®re Classe",to:63,adr:38,rp:23.9,gp:8.2,cc:28,dir:"Pierre Garnier",tel:"03 87 36 58 20",eq:["Parking","Wifi"]},
    {id:6,n:"Ibis Budget Metz",v:"Metz",lat:49.0834,lng:6.1623,ch:82,e:2,ca:1300,caM:1300,prop:"Fonds acquis 2016",acq:"Acquisition 2016",reno:"R√©no compl√®te 2016-2018",lab:["Clef Verte","Accueil V√©lo"],ens:"Accor",fr:"Ibis Budget",to:72,adr:60,rp:43.2,gp:18.2,cc:38,dir:"Thomas Petit",tel:"08 92 68 07 81",eq:["Parking","Wifi"]},
    {id:7,n:"Mercure Metz Centre",v:"Metz",lat:49.1193,lng:6.1757,ch:112,e:4,ca:4600,caM:4600,prop:"Murs et fonds",acq:"Acquisition juil. 2019",reno:"‚Äî",lab:["Clef Verte","Accueil V√©lo"],ens:"Accor",fr:"Mercure",to:78,adr:144,rp:112.3,gp:42.8,cc:82,dir:"Laurent Martin",tel:"03 87 38 50 50",eq:["Restaurant","Bar","S√©minaires","Parking","Wifi","Fitness"]},
    {id:8,n:"Ibis Budget Sarrebourg",v:"Sarrebourg",lat:48.7323,lng:7.0567,ch:61,e:2,ca:850,caM:0,prop:"Murs et fonds",acq:"Acquisition 2013",reno:"Agrandissement 2016-18",lab:["Clef Verte"],ens:"Accor",fr:"Ibis Budget",to:66,adr:58,rp:38.3,gp:14.8,cc:35,dir:"Fran√ßois Muller",tel:"03 87 03 90 90",eq:["Parking","Wifi"]},
    {id:9,n:"Premi√®re Classe Freyming",v:"Freyming-Merlebach",lat:49.1456,lng:6.7923,ch:71,e:1,ca:490,caM:0,prop:"Murs et fonds",acq:"Acquisition sept. 2018",reno:"R√©no int√©grale en cours",lab:[],ens:"Louvre Hotels",fr:"Premi√®re Classe",to:58,adr:33,rp:19.1,gp:6.4,cc:24,dir:"Yannick Weber",tel:"03 87 81 33 00",eq:["Parking","Wifi"]},
    {id:10,n:"Campanile Jouy-aux-Arches",v:"Jouy-aux-Arches",lat:49.0612,lng:6.0789,ch:59,e:3,ca:1000,caM:1000,prop:"Murs et fonds",acq:"Acquisition mars 2022",reno:"R√©no compl√®te sept. 2023",lab:["Clef Verte","Accueil V√©lo"],ens:"Louvre Hotels",fr:"Campanile",to:65,adr:71,rp:46.2,gp:15.6,cc:48,dir:"Claire Moreau",tel:"03 87 36 56 10",eq:["Restaurant","Parking","Wifi"]},
    {id:11,n:"Ibis Ch√¢lons",v:"Ch√¢lons-en-Champagne",lat:48.9589,lng:4.3612,ch:43,e:3,ca:1170,caM:0,prop:"Murs et fonds",acq:"Acquisition oct. 2023",reno:"‚Äî",lab:["Clef Verte"],ens:"Accor",fr:"Ibis",to:72,adr:103,rp:74.2,gp:26.8,cc:56,dir:"√âmilie Fournier",tel:"03 26 65 16 65",eq:["Bar","Parking","Wifi"]},
    {id:12,n:"Campanile Metz",v:"Metz",lat:49.0912,lng:6.1534,ch:75,e:3,ca:1680,caM:1680,prop:"Murs et fonds",acq:"Acquisition nov. 2023",reno:"‚Äî",lab:["Clef Verte"],ens:"Louvre Hotels",fr:"Campanile",to:71,adr:86,rp:61.1,gp:20.8,cc:55,dir:"Nathalie Leroy",tel:"03 87 63 91 00",eq:["Restaurant","Parking","Wifi"]},
    {id:13,n:"Ibis Metz Centre",v:"Metz",lat:49.1097,lng:6.1789,ch:79,e:3,ca:1900,caM:1900,prop:"Murs et fonds",acq:"Acquisition f√©v. 2025",reno:"R√©novation 2025",lab:["Accueil V√©lo"],ens:"Accor",fr:"Ibis",to:74,adr:89,rp:65.9,gp:24.1,cc:58,dir:"Sophie Bernard",tel:"03 87 31 01 73",eq:["Bar","Parking","Wifi"]},
    {id:14,n:"Ibis Styles Metz Centre",v:"Metz",lat:49.1156,lng:6.1812,ch:86,e:3,ca:2400,caM:2400,prop:"Murs et fonds",acq:"Ouverture fin 2025",reno:"Construction",lab:[],ens:"Accor",fr:"Ibis Styles",to:76,adr:100,rp:76.0,gp:28.5,cc:62,dir:"Marc Dupont",tel:"03 87 66 74 22",eq:["PDJ inclus","Bar","Wifi","Parking"]}
];

const H_NON_EXPL=[
    {id:16,n:"B&B Castres",v:"Castres (Tarn)",lat:43.6045,lng:2.2419,ch:75,e:2,prop:"Murs",liv:"Avril 2016",expl:"B&B Hotels",surf:3000},
    {id:17,n:"B&B Lyon Tassin",v:"Tassin-la-Demi-Lune",lat:45.7640,lng:4.7620,ch:102,e:2,prop:"Murs",liv:"D√©c. 2015",expl:"B&B Hotels",surf:2080}
];

const PIPELINE=[
    {id:15,n:"H√¥tel La Com√©die",v:"Metz",lat:49.1198,lng:6.1752,ch:54,e:4,caP:3800,stat:"En r√©novation",ech:"Courant 2026"},
    {id:"11b",n:"Extension Ibis Ch√¢lons",v:"Ch√¢lons",lat:48.9580,lng:4.3625,ch:22,caP:520,stat:"Planifi√©",ech:"Q2 2026"}
];

// ========== Daily data generation with seasonality ==========
const TODAY=new Date();const JFR=["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"];const MFR=["Jan","F√©v","Mar","Avr","Mai","Jun","Jul","Ao√ª","Sep","Oct","Nov","D√©c"];

const genDaily=()=>{
    const mi=TODAY.getMonth(),ji=TODAY.getDay(),cM=SEASON.monthly[mi].c,cJ=SEASON.weekly[ji===0?6:ji-1].c,seed=TODAY.getDate()*17+mi*31;
    const rnd=(a,b,s=0)=>a+((seed+s*7)%100)/100*(b-a);
    return H.map(h=>{
        const bTO=h.to/100,toD=Math.min(.98,bTO*cM*cJ*rnd(.88,1.12,h.id)),adrD=h.adr*rnd(.92,1.08,h.id+50);
        const chV=Math.round(h.ch*toD),caD=chV*adrD/1000,pk7=Math.round(h.ch*bTO*cM*rnd(.5,.85,h.id+100)),pk30=Math.round(h.ch*bTO*cM*rnd(.3,.6,h.id+200));
        return{id:h.id,n:h.n,ch:h.ch,e:h.e,toD:Math.round(toD*100),adrD:Math.round(adrD),chV,chDi:h.ch-chV,caD:Math.round(caD*10)/10,rpD:Math.round(adrD*toD*100)/100,pk7,pk30,st:toD>.8?"Excellent":toD>.65?"Bon":toD>.5?"Moyen":"Faible"};
    });
};

const genHeatmap=()=>{
    const data=[];
    for(let d=-3;d<=3;d++){
        const dt=new Date(TODAY);dt.setDate(dt.getDate()+d);
        const ji=dt.getDay(),cJ=SEASON.weekly[ji===0?6:ji-1].c,cM=SEASON.monthly[dt.getMonth()].c;
        const row={jour:JFR[ji],date:dt.getDate()+"/"+(dt.getMonth()+1),isToday:d===0,vals:{}};
        H.forEach(h=>{const seed=dt.getDate()*13+h.id*7;row.vals[h.id]=Math.min(98,Math.round(h.to*cJ*cM*(.9+((seed%20)/100))));});
        data.push(row);
    }
    return data;
};

const DAILY=genDaily();
const HEATMAP=genHeatmap();

// ========== Monthly CA/Budget with N-1 ==========
const MCB=[
    {m:"Jan",ca:1450,bg:1500,n1:1320},{m:"F√©v",ca:1380,bg:1400,n1:1290},{m:"Mar",ca:1620,bg:1600,n1:1480},
    {m:"Avr",ca:1750,bg:1700,n1:1590},{m:"Mai",ca:1890,bg:1800,n1:1720},{m:"Jun",ca:2150,bg:2000,n1:1950},
    {m:"Jul",ca:2380,bg:2200,n1:2100},{m:"Ao√ª",ca:2250,bg:2100,n1:2020},{m:"Sep",ca:2050,bg:1950,n1:1870},
    {m:"Oct",ca:1820,bg:1800,n1:1680},{m:"Nov",ca:1580,bg:1600,n1:1450},{m:"D√©c",ca:2180,bg:1850,n1:1960}
];

const SEG_REEL=[{name:"3‚òÖ",value:44.4,color:"#1e3a5f"},{name:"2‚òÖ",value:31.1,color:"#d4a853"},{name:"4‚òÖ",value:13.2,color:"#10b981"},{name:"1‚òÖ",value:11.3,color:"#94a3b8"}];

// ========== Treasury ==========
const TRES=[
    {m:"Jan",sol:1680,enc:1450,dec:1570,eH:1200,eF:180,eA:70,dS:680,dFo:280,dC:220,dE:190,dI:200},
    {m:"F√©v",sol:1420,enc:1370,dec:1630,eH:1150,eF:160,eA:60,dS:680,dFo:260,dC:215,dE:190,dI:285},
    {m:"Mar",sol:1560,enc:1625,dec:1485,eH:1350,eF:200,eA:75,dS:695,dFo:300,dC:225,dE:190,dI:75},
    {m:"Avr",sol:1890,enc:1780,dec:1450,eH:1480,eF:220,eA:80,dS:695,dFo:320,dC:230,dE:190,dI:15},
    {m:"Mai",sol:2280,enc:1915,dec:1525,eH:1580,eF:250,eA:85,dS:710,dFo:350,dC:235,dE:190,dI:40},
    {m:"Jun",sol:2790,enc:2170,dec:1660,eH:1800,eF:280,eA:90,dS:710,dFo:380,dC:240,dE:190,dI:140},
    {m:"Jul",sol:3380,enc:2395,dec:1805,eH:2000,eF:300,eA:95,dS:725,dFo:400,dC:245,dE:190,dI:245},
    {m:"Ao√ª",sol:3850,enc:2260,dec:1790,eH:1880,eF:290,eA:90,dS:725,dFo:390,dC:240,dE:190,dI:245},
    {m:"Sep",sol:3520,enc:2045,dec:2375,eH:1700,eF:260,eA:85,dS:710,dFo:360,dC:235,dE:190,dI:880},
    {m:"Oct",sol:3150,enc:1830,dec:2200,eH:1520,eF:230,eA:80,dS:710,dFo:330,dC:230,dE:190,dI:740},
    {m:"Nov",sol:2870,enc:1590,dec:1870,eH:1320,eF:200,eA:70,dS:695,dFo:290,dC:220,dE:190,dI:475},
    {m:"D√©c",sol:3190,enc:2195,dec:1875,eH:1820,eF:280,eA:95,dS:720,dFo:380,dC:245,dE:190,dI:340}
];

// ========== Immobilier ‚Äî corrig√© plaquette 16/09/2025 ==========
const IMM={
    surf:22496,val:41400,loyB:3400,loyN:3200,txC:7.3,ltv:37,det:15300,dscr:149,remb:2100,
    pTyp:[{n:"Bureaux",v:38,c:"#1e3a5f"},{n:"H√¥tels",v:28,c:"#d4a853"},{n:"Commerce",v:11,c:"#10b981"},{n:"Autre",v:10,c:"#f59e0b"},{n:"Logement",v:7,c:"#8b5cf6"},{n:"D√©p√¥t",v:6,c:"#94a3b8"}],
    pCli:[{n:"Grands Groupes",v:34,c:"#1e3a5f"},{n:"Soci√©t√©s cot√©es",v:24,c:"#d4a853"},{n:"Intra groupe",v:16,c:"#10b981"},{n:"Clients pro",v:9,c:"#f59e0b"},{n:"√âtat",v:8,c:"#8b5cf6"},{n:"Vacants",v:4,c:"#ef4444"}],
    pLoc:[{n:"Metz",v:56,c:"#1e3a5f"},{n:"France hors Metz/Moselle",v:33,c:"#d4a853"},{n:"Moselle hors Metz",v:11,c:"#10b981"}],
    actifs:[
        {l:"Forbach",t:"Cellule commerciale",s:127,loc:"En cours de location",a:"Nov. 2015"},
        {l:"Forbach",t:"Cellule commerciale",s:480,loc:"En cours de location",a:"2004"},
        {l:"Metz",t:"Immeuble bureaux",s:700,loc:"La Semaine, Europe 2, Mamytwink",a:"2025"},
        {l:"Metz",t:"Bureaux P√¥le Emploi",s:1630,loc:"P√¥le Emploi + 58 parkings",a:"F√©v. 2009"},
        {l:"Metz",t:"Habitation",s:520,loc:"Particuliers",a:"Avr. 2022"},
        {l:"Metz",t:"Commerce pied d'immeuble",s:420,loc:"Tertiaire",a:"Avr. 2022"},
        {l:"Metz",t:"Commerce",s:142,loc:"Salon de coiffure",a:"Nov. 2022"},
        {l:"Metz",t:"Parking & boxes",s:0,loc:"En cours",a:"Juin 2021"},
        {l:"Metz",t:"Bureaux HIH",s:687,loc:"HIH D√©veloppement",a:"Oct. 2022"},
        {l:"Metz Amphith√©√¢tre",t:"4 cellules commerce",s:478,loc:"Restaurants, mutuelle",a:"D√©c. 2013"},
        {l:"Ars-Laquenexy",t:"Bureaux SPIE",s:2454,loc:"SPIE + 150 parkings",a:"Nov. 2022"},
        {l:"Jouy-aux-Arches",t:"Co-bureaux LE 45",s:1920,loc:"28 PME",a:"2016"},
        {l:"Jouy-aux-Arches",t:"Entrep√¥ts SPIE",s:3400,loc:"SPIE + 12 000 m¬≤ terrain",a:"2016"},
        {l:"Manom",t:"Tertiaire",s:1200,loc:"P√¥le Emploi, int√©rim",a:"Avr. 2014"},
        {l:"Sarreguemines",t:"Halle SERNAM",s:1300,loc:"PJJ, SPIP",a:"Sept. 2012"},
        {l:"Ch√¢lons",t:"Commerce",s:204,loc:"Mutuelle",a:"2017"},
        {l:"Tassin",t:"H√¥tel B&B",s:2080,loc:"B&B Hotels 102 ch.",a:"D√©c. 2015"},
        {l:"Castres",t:"H√¥tel B&B + commerce",s:3000,loc:"B&B Hotels 77 ch.",a:"Avr. 2016"}
    ]
};

// ========== Groupe consolid√© ==========
const GRP={
    hot:{ca:21540,vMurs:61400,fComm:17600,tActifs:79000,det:36200,remb:3500,ltv:45.8,chExpl:1004,chTotal:1257},
    imm:{ca:3400,val:41400,det:15300,remb:2100,ltv:37},
    cons:{caT:24940,tActifs:120400,detT:51500,rembT:5600},
    pipe:{ch:76,caP:4320,caM:3800},
    evo:[{a:"2022",ca:16200},{a:"2023",ca:18100},{a:"2024",ca:19600},{a:"2025",ca:21540},{a:"2026P",ca:23480},{a:"2027P",ca:25860}]
};

// ========== Budget 2026 ==========
const BDG={
    rev:{t:23480,heb:{t:20300,d:[{l:"Chambres",m:18200},{l:"Petits-d√©jeuners",m:1400},{l:"Late checkout",m:350},{l:"No-show",m:200},{l:"Surclassements",m:100},{l:"Packages",m:50}]},fb:{t:2630,d:[{l:"Restaurant",m:1800},{l:"Bar",m:650},{l:"Room service",m:180}]},aut:{t:550,d:[{l:"Parking",m:280},{l:"S√©minaires",m:180},{l:"Divers",m:90}]}},
    chg:{t:16855,d:[{l:"Personnel",m:9180,p:54.5},{l:"Exploitation",m:2490,p:14.8},{l:"Commercial",m:1530,p:9.1},{l:"Franchise",m:1760,p:10.4},{l:"Administration",m:980,p:5.8},{l:"Financier",m:915,p:5.4}]},
    cpx:{t:2000,d:[{l:"R√©novations chambres",m:800},{l:"√âquipements F&B",m:400},{l:"IT / PMS",m:300},{l:"Mobilier",m:300},{l:"Divers",m:200}]},
    gop:5050,rn:4135
};

// ========== Roadmap ==========
const RDM=[
    {id:1,nom:"Ibis Styles Metz Centre",typ:"Construction",bud:8500,dep:6800,prg:80,resp:"Brice Curti",ech:"Fin 2025",rsk:null,st:"En cours",ch:86,caP:2400},
    {id:2,nom:"H√¥tel La Com√©die 4*",typ:"R√©novation",bud:12000,dep:4200,prg:35,resp:"Brice Curti",ech:"Courant 2026",rsk:"Retard fournitures",st:"En cours",ch:54,caP:3800},
    {id:3,nom:"Extension Ibis Ch√¢lons",typ:"Extension",bud:2800,dep:0,prg:0,resp:"‚Äî",ech:"Q2 2026",rsk:null,st:"Planifi√©",ch:22,caP:520},
    {id:4,nom:"R√©novation PC Freyming",typ:"R√©novation",bud:1200,dep:0,prg:0,resp:"‚Äî",ech:"Q3 2026",rsk:null,st:"Planifi√©",ch:71,caP:null},
    {id:5,nom:"PMS unifi√©",typ:"IT",bud:450,dep:279,prg:62,resp:"Guillaume Gervasoni",ech:"Q1 2026",rsk:"Formation √©quipes",st:"En cours",ch:null,caP:null},
    {id:6,nom:"Certifications Clef Verte",typ:"RSE",bud:80,dep:45,prg:56,resp:"Tristan Abisse",ech:"Q2 2026",rsk:null,st:"En cours",ch:null,caP:null},
    {id:7,nom:"Dashboards Power BI",typ:"IT",bud:120,dep:0,prg:0,resp:"‚Äî",ech:"Q1 2026",rsk:null,st:"Planifi√©",ch:null,caP:null},
    {id:8,nom:"Acquisition Nancy",typ:"Acquisition",bud:6500,dep:975,prg:15,resp:"Andr√© Heintz",ech:"2026",rsk:"Financement, concurrence",st:"√âtude",ch:null,caP:null},
    {id:9,nom:"Recrutement Juriste droit des soci√©t√©s",typ:"RH",bud:60,dep:0,prg:0,resp:"Audrey Aubry",ech:"2026",rsk:null,st:"Planifi√©",ch:null,caP:null}
];

// ========== Organigramme ==========
const ORG={
    dir:[{n:"Andr√© Heintz",p:"Fondateur"},{n:"Christophe Thiriet",p:"Co-Fondateur"}],
    sup:[{n:"Kim Souty",p:"Assistante de direction"},{n:"Marie Leclair√©e",p:"Secr√©taire"},{n:"Coralie Cesario",p:"Conciergerie"}],
    dep:[
        {nm:"Immobilier",r:"Ang√©lique Aniel",p:"Resp. organisation et projets",eq:[{n:"Florence Schaeffer",p:"Gestionnaire immo. locatif"}],col:"#1e3a5f"},
        {nm:"H√¥tellerie",r:"Ludovic de Monteclain",p:"Dir. op√©rations h√¥teli√®res",eq:[{n:"Sylvie Jodel",p:"Commerciale H√¥tels"}],col:"#d4a853"},
        {nm:"Ressources Humaines",r:"Audrey Aubry",p:"Directrice RH",eq:[{n:"Camille Lachaise",p:"Gestionnaire RH"},{n:"Julie H√©nault",p:"Gestionnaire RH"}],col:"#8b5cf6"},
        {nm:"Juridique",r:"Poste √† pourvoir",p:"Juriste droit des soci√©t√©s",eq:[],col:"#94a3b8"},
        {nm:"Comptabilit√© & Finance",r:"Christine Bastien",p:"Resp. comptabilit√©",eq:[{n:"Sophie Cholewa",p:"R√©viseur"},{n:"Alexis Pauly",p:"Asst. r√©viseur"},{n:"Saban Sivri",p:"Compta invest."},{n:"Audrey Faure",p:"Comptable"},{n:"Sasha Titren",p:"Comptable"},{n:"Ren√©e Konter",p:"Comptable"},{n:"Marie Pinthon",p:"Comptable"},{n:"Eva Casella",p:"Apprentie"}],col:"#ef4444"},
        {nm:"Communication",r:"Sandrine Bondon",p:"Resp. communication",eq:[],col:"#f59e0b"},
        {nm:"Direction Financi√®re",r:"Tristan Abisse",p:"Responsable Financier",eq:[{n:"J√©r√¥me SCAT",p:"Contr√¥leur de Gestion",isNew:true}],col:"#10b981",hasNew:true},
        {nm:"Syst√®mes d'Information",r:"Guillaume Gervasoni",p:"Resp. informatique",eq:[],col:"#3b82f6"},
        {nm:"Travaux & Agencements",r:"Brice Curti",p:"Dir. technique et travaux",eq:[{n:"Ana√Øs Lavarino",p:"Assistante"},{n:"Sandra Laheurte",p:"Resp. maintenance"},{n:"David Corbier",p:"Resp. travaux"},{n:"Sylvain R√©my",p:"Resp. technique"},{n:"Stefano Rubortone",p:"Resp. conception"}],col:"#78350f"}
    ]
};

// ========== Forecasting ==========
const genForecast=()=>{
    const cm=TODAY.getMonth();
    const ytdCA=MCB.slice(0,cm+1).reduce((s,m)=>s+m.ca,0);
    const ytdBG=MCB.slice(0,cm+1).reduce((s,m)=>s+m.bg,0);
    const ratio=ytdCA/ytdBG;
    const fc=MCB.map((m,i)=>{
        if(i<=cm)return{...m,typ:"r√©el",fc:m.ca};
        const base=m.bg*ratio;return{...m,typ:"pr√©vision",fc:Math.round(base),fcO:Math.round(base*1.05),fcP:Math.round(base*.93)};
    });
    return{fc,ytdCA,ytdBG,ratio,tFC:fc.reduce((s,m)=>s+(m.fc||m.ca),0),tO:fc.reduce((s,m)=>s+(m.fcO||m.ca),0),tP:fc.reduce((s,m)=>s+(m.fcP||m.ca),0)};
};
const FC=genForecast();

// ========== Utilities ==========
const fmt=(n,d=0)=>{if(n==null)return"‚Äî";return new Intl.NumberFormat('fr-FR',{minimumFractionDigits:d,maximumFractionDigits:d}).format(n)};
const fK=n=>fmt(n)+" K‚Ç¨";const fM=n=>(n/1000).toFixed(1).replace('.',',')+" M‚Ç¨";const fP=(n,d=1)=>fmt(n,d)+"%";const fE=n=>fmt(n)+" ‚Ç¨";

const xls=(data,fn,sn="Export")=>{const ws=XLSX.utils.json_to_sheet(data);const wb=XLSX.utils.book_new();XLSX.utils.book_append_sheet(wb,ws,sn);ws['!cols']=Object.keys(data[0]||{}).map(k=>({wch:Math.max(k.length+2,14)}));XLSX.writeFile(wb,fn+".xlsx")};

// ========== Icons ==========
const Ic={
    globe:<svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>,
    cash:<svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/></svg>,
    htl:<svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>,
    bld:<svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 14v3m4-3v3m4-3v3M3 21h18M3 10h18M3 7l9-4 9 4M4 10h16v11H4V10z"/></svg>,
    calc:<svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>,
    map:<svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/></svg>,
    clip:<svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/></svg>,
    usr:<svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/></svg>,
    sun:<svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg>,
    grp:<svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5"/></svg>,
    chrt:<svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>,
    dl:<svg xmlns="http://www.w3.org/2000/svg" className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>,
    up:<svg xmlns="http://www.w3.org/2000/svg" className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 10l7-7m0 0l7 7m-7-7v18"/></svg>,
    dn:<svg xmlns="http://www.w3.org/2000/svg" className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 14l-7 7m0 0l-7-7m7 7V3"/></svg>,
    wrn:<svg xmlns="http://www.w3.org/2000/svg" className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4.832c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"/></svg>
};

// ========== Shared Components ==========
const KPI=({label,value,unit,trend,tl,color="primary",icon})=>{
    const cm={primary:"border-l-primary",secondary:"border-l-secondary",success:"border-l-success",warning:"border-l-warning",danger:"border-l-danger"};
    const tc=trend>0?"text-success":trend<0?"text-danger":"text-muted";
    return(<div className={"kpi-card bg-white rounded-xl p-4 shadow-sm border-l-4 "+(cm[color]||cm.primary)}>
        <div className="flex items-center justify-between mb-1"><span className="text-xs font-medium text-muted">{label}</span>{icon&&<span className="text-muted opacity-40">{icon}</span>}</div>
        <div className="flex items-baseline gap-1"><span className="text-xl font-bold text-gray-900">{value}</span>{unit&&<span className="text-xs text-muted">{unit}</span>}</div>
        {(trend!=null)&&<div className={"flex items-center gap-1 mt-1 text-xs font-medium "+tc}>{trend>0?Ic.up:trend<0?Ic.dn:null}<span>{trend>0?"+":""}{typeof trend==='number'?trend.toFixed(1):trend}{tl||""}</span></div>}
    </div>);
};
const Bdg=({statut})=>{const s={"En cours":"bg-blue-100 text-blue-700","Planifi√©":"bg-gray-100 text-gray-600","√âtude":"bg-purple-100 text-purple-700","Confort":"bg-green-100 text-green-700","Vigilance":"bg-orange-100 text-orange-700","Critique":"bg-red-100 text-red-700","Excellent":"bg-green-100 text-green-700","Bon":"bg-blue-100 text-blue-700","Moyen":"bg-orange-100 text-orange-700","Faible":"bg-red-100 text-red-700"};return <span className={"status-badge "+(s[statut]||"bg-gray-100 text-gray-600")}>{statut}</span>};
const XBtn=({onClick,label="Export"})=><button onClick={onClick} className="export-btn flex items-center gap-2 px-3 py-1.5 bg-primary text-white rounded-lg text-xs font-medium hover:bg-opacity-90">{Ic.dl}{label}</button>;
const Sec=({children,right})=><div className="flex items-center justify-between mb-3"><h3 className="text-base font-bold text-gray-900">{children}</h3>{right}</div>;
const CTip=({active,payload,label})=>{if(!active||!payload)return null;return(<div className="bg-white p-2.5 rounded-lg shadow-lg border border-gray-100 text-xs"><p className="font-semibold text-gray-900 mb-1">{label}</p>{payload.map((p,i)=><p key={i} style={{color:p.color}} className="flex justify-between gap-3"><span>{p.name}</span><span className="font-medium">{fmt(p.value)} K‚Ç¨</span></p>)}</div>)};


// ========== P&L Data ==========
const PNL={cols:["2024","2025","Budget 2026"],
    hot:[
        {l:"CHIFFRE D'AFFAIRES",style:"header"},
        {l:"H√©bergement",v:[12050,15720,18200]},
        {l:"Restauration & Bar",v:[2150,2800,3080]},
        {l:"Petits-d√©jeuners",v:[990,1290,1400]},
        {l:"S√©minaires & √©v√©nements",v:[500,650,550]},
        {l:"Parking & autres",v:[810,1080,250]},
        {l:"TOTAL CA H√îTELIER",v:[16500,21540,23480],style:"total"},
        {l:"",style:"spacer"},
        {l:"CHARGES D'EXPLOITATION",style:"header"},
        {l:"Co√ªt marchandises (F&B)",v:[-1480,-1930,-2110]},
        {l:"Charges de personnel",v:[-7100,-9260,-9180]},
        {l:"√ânergie & fluides",v:[-990,-1290,-1410]},
        {l:"Entretien & r√©parations",v:[-580,-750,-820]},
        {l:"Charges externes",v:[-830,-1080,-1180]},
        {l:"Frais commerciaux",v:[-1160,-1510,-1530]},
        {l:"Taxes & assurances",v:[-460,-600,-660]},
        {l:"TOTAL CHARGES DIRECTES",v:[-12600,-16420,-16890],style:"total"},
        {l:"",style:"spacer"},
        {l:"MARGE BRUTE D'EXPLOITATION",v:[3900,5120,6590],style:"highlight"},
        {l:"Marge %",v:[23.6,23.8,28.1],style:"pct"},
        {l:"Redevances franchise",v:[-1320,-1720,-1760]},
        {l:"Frais g√©n√©raux & si√®ge",v:[-825,-1077,-980]},
        {l:"GOP (Gross Operating Profit)",v:[1755,2323,3850],style:"highlight"},
        {l:"Marge GOP %",v:[10.6,10.8,16.4],style:"pct"},
        {l:"",style:"spacer"},
        {l:"Dotations amortissements",v:[-1650,-2150,-2350]},
        {l:"R√âSULTAT D'EXPLOITATION",v:[105,173,1500],style:"total"},
        {l:"",style:"spacer"},
        {l:"Charges d'int√©r√™ts",v:[-1085,-1050,-915]},
        {l:"Produits financiers",v:[25,30,40]},
        {l:"R√âSULTAT FINANCIER",v:[-1060,-1020,-875],style:"subtotal"},
        {l:"",style:"spacer"},
        {l:"R√âSULTAT COURANT",v:[-955,-847,625],style:"total"},
        {l:"R√©sultat exceptionnel",v:[-80,45,-65]},
        {l:"Imp√¥t sur les soci√©t√©s",v:[0,0,-140]},
        {l:"R√âSULTAT NET H√îTELIER",v:[-1035,-802,420],style:"result"},
        {l:"Marge nette %",v:[-6.3,-3.7,1.8],style:"pct"},
    ],
    immo:[
        {l:"Loyers bruts",v:[3100,3200,3400],style:"total"},
        {l:"Charges locatives",v:[-310,-320,-340]},
        {l:"Taxes fonci√®res",v:[-186,-192,-204]},
        {l:"Assurances",v:[-93,-96,-102]},
        {l:"Entretien & gestion",v:[-155,-160,-170]},
        {l:"LOYERS NETS",v:[2356,2432,2584],style:"highlight"},
        {l:"Marge %",v:[76.0,76.0,76.0],style:"pct"},
        {l:"Dotations amortissements",v:[-414,-432,-476]},
        {l:"Charges d'int√©r√™ts",v:[-612,-580,-535]},
        {l:"R√âSULTAT IMMOBILIER NET",v:[1330,1420,1573],style:"result"},
        {l:"Marge nette %",v:[42.9,44.4,46.3],style:"pct"},
    ],
    conso:[
        {l:"CA H√¥telier",v:[16500,21540,23480]},
        {l:"Revenus immobiliers",v:[3100,3200,3400]},
        {l:"TOTAL PRODUITS",v:[19600,24740,26880],style:"total"},
        {l:"",style:"spacer"},
        {l:"Charges exploitation h√¥teli√®re",v:[-12600,-16420,-16890]},
        {l:"Charges immobili√®res",v:[-744,-768,-816]},
        {l:"Franchise & royalties",v:[-1320,-1720,-1760]},
        {l:"Frais si√®ge & administration",v:[-825,-1077,-980]},
        {l:"TOTAL CHARGES",v:[-15489,-19985,-20446],style:"total"},
        {l:"",style:"spacer"},
        {l:"EBE CONSOLID√â",v:[4111,4755,6434],style:"highlight"},
        {l:"Marge EBE %",v:[21.0,19.2,23.9],style:"pct"},
        {l:"Amortissements totaux",v:[-2064,-2582,-2826]},
        {l:"R√âSULTAT D'EXPLOITATION",v:[2047,2173,3608],style:"total"},
        {l:"R√©sultat financier",v:[-1672,-1600,-1410]},
        {l:"R√âSULTAT COURANT",v:[375,573,2198],style:"total"},
        {l:"Exceptionnel & IS",v:[-80,45,-205]},
        {l:"R√âSULTAT NET CONSOLID√â",v:[295,618,1993],style:"result"},
        {l:"Marge nette %",v:[1.5,2.5,7.4],style:"pct"},
    ]
};


// ========== RSE Data (coh√©rent : 14 h√¥tels, 1 004 ch., ~249k nuit√©es/an) ==========
const RSE_DATA={
    carbone:{total:4180,
        scopes:[{l:"Scope 1 ‚Äî √âmissions directes",v:1480,c:"#ef4444",detail:[{l:"Chauffage gaz/fioul",v:1080},{l:"Fluides frigorig√®nes",v:220},{l:"V√©hicules de service",v:180}]},
                {l:"Scope 2 ‚Äî √ânergie indirecte",v:540,c:"#f59e0b",detail:[{l:"√âlectricit√© (facteur FR 79g)",v:460},{l:"R√©seau de chaleur urbain",v:80}]},
                {l:"Scope 3 ‚Äî Autres indirectes",v:2160,c:"#94a3b8",detail:[{l:"D√©placements clients",v:720},{l:"Achats & sous-traitance",v:580},{l:"Linge & blanchisserie",v:380},{l:"Traitement d√©chets",v:260},{l:"Num√©rique & IT",v:220}]}],
        evo:[{a:"2022",v:4850},{a:"2023",v:4620},{a:"2024",v:4380},{a:"2025",v:4180},{a:"2026P",v:3900},{a:"2028Obj",v:3500},{a:"2030Obj",v:3340}],
        parChambre:4.2,benchmark:6.5,objectif2030:3340
    },
    energie:{conso:11200,kwh_chambre:11155,benchmark_chambre:14500,
        parType:[{l:"√âlectricit√©",v:5800,c:"#f59e0b"},{l:"Gaz naturel",v:4600,c:"#ef4444"},{l:"R√©seau de chaleur",v:800,c:"#8b5cf6"}],
        evo:[{a:"2022",v:12800},{a:"2023",v:12100},{a:"2024",v:11600},{a:"2025",v:11200}]},
    eau:{total:64200,parNuitee:251,benchmark:300,objectif:200,unite:"L"},
    dechets:{total:334,parNuitee:1.3,benchmark:1.8,tri:62,objectifTri:80,unite:"kg",
        parType:[{l:"Ordures m√©nag√®res",v:38,c:"#94a3b8"},{l:"Carton/Papier",v:24,c:"#d4a853"},{l:"Verre",v:15,c:"#10b981"},{l:"Plastique",v:12,c:"#3b82f6"},{l:"Biod√©chets",v:8,c:"#059669"},{l:"Autres",v:3,c:"#78350f"}]},
    actions:[
        {l:"LED 100% √©tablissements",st:"Fait",prg:100,cat:"√ânergie",eco:"‚àí520 MWh/an"},
        {l:"Suppression plastique usage unique",st:"Fait",prg:100,cat:"D√©chets",eco:"‚àí2,1 t/an"},
        {l:"Produits entretien √©co-certifi√©s",st:"En cours",prg:85,cat:"Achats",eco:"‚àí35 tCO‚ÇÇe"},
        {l:"Tri s√©lectif 5 flux (14 sites)",st:"En cours",prg:72,cat:"D√©chets",eco:"+18 pts tri"},
        {l:"Circuits courts F&B (‚àí30% import)",st:"En cours",prg:45,cat:"Achats",eco:"‚àí95 tCO‚ÇÇe"},
        {l:"Bornes recharge VE (6 sites)",st:"En cours",prg:35,cat:"Mobilit√©",eco:"Attractivit√©"},
        {l:"Audit √©nerg√©tique DPE (14 sites)",st:"Planifi√©",prg:10,cat:"√ânergie",eco:"Base travaux"},
        {l:"Panneaux solaires (3 sites pilotes)",st:"Planifi√©",prg:5,cat:"√ânergie",eco:"‚àí180 MWh/an"},
        {l:"R√©cup√©ration eaux grises",st:"√âtude",prg:0,cat:"Eau",eco:"‚àí15% conso eau"},
        {l:"Compensation carbone volontaire",st:"√âtude",prg:0,cat:"Carbone",eco:"Neutralit√© 2035"}
    ],
    labels:[
        {l:"Clef Verte",n:10,total:14,c:"#10b981"},
        {l:"Accueil V√©lo",n:7,total:14,c:"#3b82f6"},
        {l:"√âcolabel Europ√©en",n:0,total:14,c:"#8b5cf6",obj:"3 sites vis√©s en 2027"}
    ]
};
// ========== TABS ==========
const TABS=[
    {id:"synthese",label:"Synth√®se",icon:Ic.sun},
    {id:"pnl",label:"P&L",icon:<svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>},
    {id:"tresorerie",label:"Tr√©sorerie",icon:Ic.cash},
    {id:"pilotage",label:"Pilotage CDG",icon:<svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"/></svg>},
    {id:"immobilier",label:"Immobili√®re",icon:Ic.bld},
    {id:"etablissements",label:"√âtablissements",icon:Ic.map},
    {id:"budget",label:"Budget & Projets",icon:Ic.calc},
    {id:"rse",label:"RSE",icon:<svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064"/></svg>},
    {id:"organigramme",label:"√âquipe",icon:Ic.usr}
]

const Nav=({tab,set})=>(
    <nav className="sticky top-0 z-40 bg-white shadow-sm border-b border-gray-200 no-print">
        <div className="max-w-7xl mx-auto"><div className="nav-scroll flex">
            {TABS.map(t=><button key={t.id} onClick={()=>set(t.id)} className={"nav-tab flex items-center gap-1.5 px-3 py-2.5 text-xs whitespace-nowrap "+(tab===t.id?'active':'text-muted border-b-transparent')}>{t.icon}<span className="hidden md:inline">{t.label}</span></button>)}
        </div></div>
    </nav>
);

const COLS=["#1e3a5f","#d4a853","#10b981","#f59e0b","#8b5cf6","#94a3b8","#ef4444","#06b6d4"];

// ===== 1. DAILY PAGE =====
const DailyPage=()=>{
    const totCH=DAILY.reduce((s,d)=>s+d.ch,0),totCV=DAILY.reduce((s,d)=>s+d.chV,0);
    const avgTO=Math.round(totCV/totCH*100),avgADR=Math.round(DAILY.reduce((s,d)=>s+d.adrD,0)/DAILY.length);
    const avgRP=Math.round(avgADR*avgTO/100),totCA=DAILY.reduce((s,d)=>s+d.caD,0).toFixed(1);
    const mi=TODAY.getMonth(),ji=TODAY.getDay(),sm=SEASON.monthly[mi],sj=SEASON.weekly[ji===0?6:ji-1];
    const alerts=DAILY.filter(d=>d.toD<55),warns=DAILY.filter(d=>d.toD>=55&&d.toD<65);
    return(<div className="slide-enter space-y-6">
        <div className="p-2 bg-amber-50 border border-amber-200 rounded-lg text-[10px] text-amber-700 flex items-center gap-2">{Ic.wrn} Donn√©es simul√©es √† des fins de d√©monstration ‚Äî En production : connexion PMS temps r√©el (Opera, Mews, D-Edge)</div>
        <div className="flex flex-wrap items-center gap-3">
            <span className="live-dot"></span>
            <span className="text-sm font-semibold text-gray-700">{TODAY.toLocaleDateString('fr-FR',{weekday:'long',day:'numeric',month:'long',year:'numeric'})}</span>
            <span className="text-xs text-muted bg-gray-100 px-2 py-1 rounded-full">Saisonnalit√© : {sm.l} ({(sm.c>1?"+":"")+Math.round((sm.c-1)*100)}% mois) ¬∑ {sj.j} ({(sj.c>1?"+":"")+Math.round((sj.c-1)*100)}% jour)</span>
        </div>
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
            <KPI label="TO moyen" value={avgTO+"%"} color="primary" icon={Ic.htl}/>
            <KPI label="ADR moyen" value={avgADR+" ‚Ç¨"} color="secondary" icon={Ic.cash}/>
            <KPI label="RevPAR" value={avgRP+" ‚Ç¨"} color="success"/>
            <KPI label="CA du jour" value={totCA+" K‚Ç¨"} color="warning"/>
        </div>
        <div className="bg-white rounded-xl shadow-sm p-4 overflow-hidden">
            <Sec right={<XBtn onClick={()=>xls(DAILY.map(d=>({Hotel:d.n,Etoiles:d.e,Chambres:d.ch,TO:d.toD+"%",ADR:d.adrD+"‚Ç¨",RevPAR:d.rpD+"‚Ç¨",CA_K:d.caD,Pickup_7j:d.pk7,Pickup_30j:d.pk30,Statut:d.st})),"journalier")}/>}>Heatmap TO ‚Äî Semaine glissante</Sec>
            <div className="overflow-x-auto">
                <table className="w-full text-xs"><thead><tr><th className="text-left p-1.5 text-muted font-medium">√âtablissement</th>
                {HEATMAP.map((d,i)=><th key={i} className={"text-center p-1.5 "+(d.isToday?"font-bold text-primary bg-blue-50 rounded":"text-muted")}>{d.jour}<br/><span className="text-[10px]">{d.date}</span></th>)}
                </tr></thead><tbody>
                {H.map(h=>{const short=h.n.replace(/^(Ibis Styles |Ibis Budget |Ibis |Premi√®re Classe |Campanile |Mercure |B&B )/,"");
                return <tr key={h.id} className="border-t border-gray-50"><td className="p-1.5 font-medium truncate max-w-[140px]" title={h.n}>{short}</td>
                {HEATMAP.map((d,i)=>{const v=d.vals[h.id];const bg=v>=80?"#10b981":v>=65?"#86efac":v>=50?"#fbbf24":"#f87171";
                return <td key={i} className="p-1 text-center"><div className={"heatmap-cell mx-auto w-12 py-0.5 text-white text-xs font-semibold"+(d.isToday?" ring-2 ring-primary ring-offset-1":"")} style={{background:bg}}>{v}%</div></td>})}
                </tr>})}</tbody></table>
            </div>
        </div>
        <div className="bg-white rounded-xl shadow-sm p-4">
            <Sec>Performance d√©taill√©e</Sec>
            <div className="overflow-x-auto"><table className="w-full text-xs">
                <thead className="bg-gray-50"><tr>{["H√¥tel","‚òÖ","Ch.","TO","ADR","RevPAR","CA","Pickup 7j","Pickup 30j","Statut"].map(h=><th key={h} className="p-2 text-left text-muted font-medium">{h}</th>)}</tr></thead>
                <tbody>{[...DAILY].sort((a,b)=>b.caD-a.caD).map(d=><tr key={d.id} className="border-t border-gray-100 hover:bg-gray-50">
                    <td className="p-2 font-medium">{d.n}</td><td className="p-2 text-yellow-500">{"‚òÖ".repeat(d.e)}</td><td className="p-2">{d.ch}</td>
                    <td className={"p-2 font-bold "+(d.toD>=75?"text-green-600":d.toD>=60?"text-blue-600":"text-red-600")}>{d.toD}%</td>
                    <td className="p-2">{d.adrD} ‚Ç¨</td><td className="p-2">{d.rpD} ‚Ç¨</td><td className="p-2 font-semibold">{d.caD} K‚Ç¨</td>
                    <td className="p-2 text-blue-600">{d.pk7} ch.</td><td className="p-2 text-blue-600">{d.pk30} ch.</td>
                    <td className="p-2"><Bdg statut={d.st}/></td>
                </tr>)}</tbody></table></div>
        </div>
        {(alerts.length>0||warns.length>0)&&<div className="bg-white rounded-xl shadow-sm p-4"><Sec>Alertes</Sec><div className="space-y-2">
            {alerts.map(d=><div key={d.id} className="flex items-center gap-2 p-2.5 bg-red-50 rounded-lg text-xs">{Ic.wrn}<span className="font-medium text-red-700">{d.n} ‚Äî TO {d.toD}% sous le seuil de rentabilit√©</span></div>)}
            {warns.map(d=><div key={d.id} className="flex items-center gap-2 p-2.5 bg-orange-50 rounded-lg text-xs">{Ic.wrn}<span className="font-medium text-orange-700">{d.n} ‚Äî TO {d.toD}% vigilance</span></div>)}
        </div></div>}
        {alerts.length===0&&warns.length===0&&<div className="p-3 bg-green-50 rounded-lg text-xs font-medium text-green-700 flex items-center gap-2"><span>‚úì</span> Tous les √©tablissements au-dessus de 65% ‚Äî Bonne performance</div>}
    </div>);
};

// ===== 2. GROUPE PAGE =====
const GroupePage=()=>{
    const g=GRP;
    return(<div className="slide-enter space-y-6">
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
            <KPI label="CA Total Groupe" value={fM(g.cons.caT)} color="primary" trend={5.2} tl="% vs N-1" icon={Ic.grp}/>
            <KPI label="Total Actifs" value={fM(g.cons.tActifs)} color="secondary"/>
            <KPI label="Dette Totale" value={fM(g.cons.detT)} color="danger"/>
            <KPI label="Remb. Annuel" value={fM(g.cons.rembT)} color="warning"/>
        </div>
        <div className="grid md:grid-cols-2 gap-6">
            <div className="bg-white rounded-xl shadow-sm p-5">
                <h4 className="font-bold text-sm mb-3 text-primary flex items-center gap-2">{Ic.htl} P√¥le H√¥telier</h4>
                <div className="space-y-2 text-xs">
                    <div className="flex justify-between"><span className="text-muted">CA h√¥telier</span><span className="font-semibold">{fM(g.hot.ca)}</span></div>
                    <div className="flex justify-between"><span className="text-muted">Valeur murs</span><span className="font-semibold">{fM(g.hot.vMurs)}</span></div>
                    <div className="flex justify-between"><span className="text-muted">Fonds de commerce</span><span className="font-semibold">{fM(g.hot.fComm)}</span></div>
                    <div className="flex justify-between"><span className="text-muted">Total actifs h√¥teliers</span><span className="font-bold text-primary">{fM(g.hot.tActifs)}</span></div>
                    <div className="flex justify-between"><span className="text-muted">Dette h√¥teli√®re</span><span className="font-semibold text-red-600">{fM(g.hot.det)}</span></div>
                    <div className="flex justify-between"><span className="text-muted">LTV</span><span className="font-semibold">{fP(g.hot.ltv)}</span></div>
                    <div className="flex justify-between"><span className="text-muted">Remb. annuel</span><span className="font-semibold">{fM(g.hot.remb)}</span></div>
                    <div className="flex justify-between"><span className="text-muted">Chambres exploit√©es</span><span className="font-semibold">{fmt(g.hot.chExpl)}</span></div>
                </div>
            </div>
            <div className="bg-white rounded-xl shadow-sm p-5">
                <h4 className="font-bold text-sm mb-3 text-secondary flex items-center gap-2">{Ic.bld} P√¥le Immobilier</h4>
                <div className="space-y-2 text-xs">
                    <div className="flex justify-between"><span className="text-muted">Loyers bruts</span><span className="font-semibold">{fM(g.imm.ca)}</span></div>
                    <div className="flex justify-between"><span className="text-muted">Valorisation patrimoine</span><span className="font-semibold">{fM(g.imm.val)}</span></div>
                    <div className="flex justify-between"><span className="text-muted">Dette immobili√®re</span><span className="font-semibold text-red-600">{fM(g.imm.det)}</span></div>
                    <div className="flex justify-between"><span className="text-muted">LTV</span><span className="font-semibold">{fP(g.imm.ltv)}</span></div>
                    <div className="flex justify-between"><span className="text-muted">Remb. annuel</span><span className="font-semibold">{fM(g.imm.remb)}</span></div>
                    <div className="flex justify-between"><span className="text-muted">Surface totale</span><span className="font-semibold">{fmt(IMM.surf)} m¬≤</span></div>
                </div>
            </div>
        </div>
        <div className="bg-white rounded-xl shadow-sm p-5">
            <Sec>√âvolution CA Groupe (K‚Ç¨)</Sec>
            <ResponsiveContainer width="100%" height={280}>
                <ComposedChart data={g.evo}><CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0"/>
                <XAxis dataKey="a" tick={{fontSize:11}} stroke="#94a3b8"/>
                <YAxis tick={{fontSize:11}} stroke="#94a3b8"/>
                <Tooltip/>
                <Bar dataKey="ca" fill="#1e3a5f" name="CA K‚Ç¨" radius={[4,4,0,0]}/>
                <Line type="monotone" dataKey="ca" stroke="#d4a853" strokeWidth={2} dot={{r:4}}/>
                </ComposedChart>
            </ResponsiveContainer>
        </div>
        <div className="bg-white rounded-xl shadow-sm p-4">
            <Sec>Pipeline & Projets</Sec>
            <div className="grid md:grid-cols-2 gap-4">
                {PIPELINE.map(p=><div key={p.id} className="p-3 border border-green-200 bg-green-50 rounded-lg text-xs">
                    <div className="font-bold text-green-800">{p.n}</div>
                    <div className="text-muted mt-1">{p.v} ¬∑ {p.ch} chambres ¬∑ CA pr√©v. {fmt(p.caP)} K‚Ç¨</div>
                    <div className="mt-1"><Bdg statut={p.stat}/> <span className="text-muted ml-2">√âch√©ance : {p.ech}</span></div>
                </div>)}
            </div>
        </div>
    </div>);
};

// ===== 3. GLOBAL PAGE =====
const GlobalePage=()=>{
    const totalCH=H.reduce((s,h)=>s+h.ch,0),totalCA=H.reduce((s,h)=>s+h.ca,0);
    const avgTO=(H.reduce((s,h)=>s+h.to,0)/H.length).toFixed(1);
    const avgADR=Math.round(H.reduce((s,h)=>s+h.adr,0)/H.length);
    const avgRP=Math.round(H.reduce((s,h)=>s+h.rp,0)/H.length);
    const caPerCh=(totalCA/totalCH).toFixed(1);
    const caM=H.filter(h=>h.caM>0).reduce((s,h)=>s+h.caM,0);
    const pMetz=Math.round(caM/totalCA*100);
    const chartData=FC.fc.map(m=>({m:m.m,reel:m.typ==="r√©el"?m.ca:null,prev:m.typ==="pr√©vision"?m.fc:null,bg:m.bg,n1:m.n1}));
    return(<div className="slide-enter space-y-6">
        <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
            <KPI label="CA H√¥telier" value={fM(totalCA)} color="primary" trend={5.2} tl="% vs N-1"/>
            <KPI label="Chambres" value={fmt(totalCH)} color="secondary"/>
            <KPI label="TO moyen" value={fP(avgTO)} color="success" trend={2.1} tl=" pts"/>
            <KPI label="RevPAR" value={avgRP+" ‚Ç¨"} color="warning" trend={4.8} tl="%"/>
            <KPI label="ADR moyen" value={avgADR+" ‚Ç¨"} color="primary"/>
            <KPI label="CA/chambre" value={caPerCh+" K‚Ç¨"} color="secondary"/>
        </div>
        <div className="grid md:grid-cols-3 gap-6">
            <div className="md:col-span-2 bg-white rounded-xl shadow-sm p-5">
                <Sec right={<XBtn onClick={()=>xls(FC.fc.map(m=>({Mois:m.m,CA_Reel:m.typ==="r√©el"?m.ca:"",Prevision:m.fc||"",Budget:m.bg,N1:m.n1})),"ca_mensuel")}/>}>CA Mensuel ‚Äî R√©el, Pr√©vision, Budget, N-1 (K‚Ç¨)</Sec>
                <ResponsiveContainer width="100%" height={300}>
                    <ComposedChart data={chartData}><CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0"/>
                    <XAxis dataKey="m" tick={{fontSize:11}} stroke="#94a3b8"/>
                    <YAxis tick={{fontSize:11}} stroke="#94a3b8"/>
                    <Tooltip content={<CTip/>}/>
                    <Legend wrapperStyle={{fontSize:11}}/>
                    <Bar dataKey="reel" fill="#1e3a5f" name="CA R√©el" radius={[4,4,0,0]}/>
                    <Bar dataKey="prev" fill="#10b981" fillOpacity={0.7} name="Pr√©vision" radius={[4,4,0,0]}/>
                    <Line type="monotone" dataKey="bg" stroke="#d4a853" name="Budget" strokeWidth={2} dot={false}/>
                    <Line type="monotone" dataKey="n1" stroke="#94a3b8" name="N-1" strokeDasharray="5 5" dot={false}/>
                    </ComposedChart>
                </ResponsiveContainer>
                <div className="flex gap-4 mt-3 text-xs text-muted">
                    <span>Pr√©vision annuelle : <strong className="text-gray-900">{fK(FC.tFC)}</strong></span>
                    <span>Ratio YTD/Budget : <strong className={(FC.ratio>=1?"text-green-600":"text-red-600")}>{fP(FC.ratio*100)}</strong></span>
                </div>
                <div className="mt-3 border-t pt-3">
                    <div className="text-xs font-semibold text-gray-700 mb-2">Calendrier √©v√©nementiel Grand Est</div>
                    <div className="grid grid-cols-6 md:grid-cols-12 gap-1">
                        {EVENTS.map(e=><div key={e.m} className={"group relative rounded-lg p-1.5 text-center text-[9px] cursor-pointer "+(e.impact>=10?"bg-green-100 text-green-800":e.impact>=5?"bg-blue-50 text-blue-700":e.impact>0?"bg-gray-50 text-gray-600":"bg-red-50 text-red-600")}>
                            <div className="font-bold">{MFR[e.m-1]}</div>
                            <div>{e.ico}</div>
                            <div className="font-semibold">{e.impact>0?"+":""}{e.impact}%</div>
                            <div className="hidden group-hover:block absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 p-2.5 bg-gray-900 text-white rounded-lg shadow-xl z-50 text-left pointer-events-none">
                                <div className="font-bold text-[11px] mb-1">{e.nom}</div>
                                <div className="text-[10px] opacity-75 mb-0.5">Type : <span className="capitalize">{e.type}</span></div>
                                <div className="text-[10px]">Impact TO : <span className={e.impact>0?"text-green-400":"text-red-400"}>{e.impact>0?"+":""}{e.impact}%</span></div>
                            </div>
                        </div>)}
                    </div>
                </div>
            </div>
            <div className="bg-white rounded-xl shadow-sm p-5">
                <Sec>Segments (r√©el)</Sec>
                <ResponsiveContainer width="100%" height={220}>
                    <PieChart><Pie data={SEG_REEL} dataKey="value" nameKey="name" cx="50%" cy="50%" outerRadius={75} label={({name,value})=>name+" "+value+"%"} labelLine={false} fontSize={10}>
                    {SEG_REEL.map((d,i)=><Cell key={i} fill={d.color}/>)}</Pie><Tooltip/></PieChart>
                </ResponsiveContainer>
                <div className="mt-3 p-3 bg-blue-50 rounded-lg text-xs">
                    <span className="font-semibold text-primary">Concentration Metz : {pMetz}%</span>
                    <span className="text-muted block mt-1">{H.filter(h=>h.caM>0).length} √©tablissements sur {H.length}</span>
                </div>
            </div>
        </div>
        <div className="bg-white rounded-xl shadow-sm p-4">
            <Sec right={<XBtn onClick={()=>xls(H.map(h=>({Hotel:h.n,Ville:h.v,Etoiles:h.e,Chambres:h.ch,CA_K:h.ca,TO:h.to+"%",ADR:h.adr+"‚Ç¨",RevPAR:h.rp+"‚Ç¨"})),"hotels")}/>}>Top performers</Sec>
            <div className="grid md:grid-cols-3 gap-3 text-xs">
                <div className="p-3 bg-green-50 rounded-lg"><span className="text-muted">Meilleur TO</span><br/><strong>{[...H].sort((a,b)=>b.to-a.to)[0].n}</strong> ‚Äî {[...H].sort((a,b)=>b.to-a.to)[0].to}%</div>
                <div className="p-3 bg-yellow-50 rounded-lg"><span className="text-muted">Meilleur ADR</span><br/><strong>{[...H].sort((a,b)=>b.adr-a.adr)[0].n}</strong> ‚Äî {[...H].sort((a,b)=>b.adr-a.adr)[0].adr} ‚Ç¨</div>
                <div className="p-3 bg-blue-50 rounded-lg"><span className="text-muted">Meilleur CA</span><br/><strong>{[...H].sort((a,b)=>b.ca-a.ca)[0].n}</strong> ‚Äî {fK([...H].sort((a,b)=>b.ca-a.ca)[0].ca)}</div>
            </div>
        </div>
    </div>);
};

// ===== 4. TRESORERIE PAGE =====
const TresoreriePage=()=>{
    const [vue,setVue]=useState("mensuel");
    const cm=TODAY.getMonth(),cd=TODAY.getDate();
    const dH=GRP.hot.det,dI=GRP.imm.det,dT=GRP.cons.detT;

    const mData=TRES.map((t,i)=>({...t,isFuture:i>cm}));
    const avgSol=Math.round(TRES.reduce((s,t)=>s+t.sol,0)/12);
    const minSol=Math.min(...TRES.map(t=>t.sol));

    const jData=useMemo(()=>{
        const days=[];const mInfo=TRES[cm];const dim=new Date(TODAY.getFullYear(),cm+1,0).getDate();
        let bal=Math.round(mInfo.sol*0.85);
        for(let d=1;d<=dim;d++){
            const dt=new Date(TODAY.getFullYear(),cm,d);const ji=dt.getDay();
            const cJ=SEASON.weekly[ji===0?6:ji-1].c;const seed=d*17+cm*31;
            const enc=Math.round(mInfo.enc/dim*cJ*(0.85+(seed%30)/100));
            const dec=Math.round(mInfo.dec/dim*(0.9+((seed*7)%20)/100));
            bal+=enc-dec;
            days.push({date:d+"/"+(cm+1),jour:JFR[ji],enc,dec,net:enc-dec,sol:bal,isFuture:d>cd});
        }
        return days;
    },[]);

    const sData=useMemo(()=>{
        const weeks=[];
        for(let w=-4;w<=4;w++){
            const ws=new Date(TODAY);ws.setDate(ws.getDate()+w*7-TODAY.getDay()+1);
            let enc=0,dec=0;
            for(let d=0;d<7;d++){
                const dt=new Date(ws);dt.setDate(dt.getDate()+d);const mi=dt.getMonth();
                if(mi>=0&&mi<12){const m=TRES[mi];const cJ=SEASON.weekly[d<6?d:6].c;
                enc+=Math.round(m.enc/4.33/7*cJ);dec+=Math.round(m.dec/4.33/7*(0.95+d*0.01));}
            }
            const mi2=ws.getMonth();
            weeks.push({date:"S"+(w+5),label:ws.toLocaleDateString('fr-FR',{day:'2-digit',month:'2-digit'}),enc,dec,net:enc-dec,sol:TRES[mi2]?TRES[mi2].sol:0,isFuture:w>0});
        }
        return weeks;
    },[]);

    const data=vue==="mensuel"?mData:vue==="journalier"?jData:sData;

    return(<div className="slide-enter space-y-6">
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
            <KPI label="Solde moyen" value={fK(avgSol)} color="primary" icon={Ic.cash}/>
            <KPI label="Remb. annuel total" value={fM(GRP.cons.rembT)} color="danger"/>
            <KPI label="DSCR Immobilier" value={fP(IMM.dscr)} color={IMM.dscr>=120?"success":"warning"}/>
            <KPI label="LTV global" value={fP(Math.round(dT/GRP.cons.tActifs*100))} color="secondary"/>
        </div>
        <div className="bg-white rounded-xl shadow-sm p-5">
            <div className="flex items-center justify-between mb-4">
                <Sec>Flux de tr√©sorerie (K‚Ç¨)</Sec>
                <div className="flex gap-1">
                    {[["journalier","Jour"],["hebdo","Semaine"],["mensuel","Mois"]].map(([k,l])=>
                        <button key={k} onClick={()=>setVue(k)} className={"px-3 py-1.5 rounded-lg text-xs font-medium transition-colors "+(vue===k?"bg-primary text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200")}>{l}</button>
                    )}
                </div>
            </div>
            <div className="text-xs text-muted mb-2 flex items-center gap-2">
                <span className="w-3 h-3 rounded bg-green-500 inline-block"></span> Encaissements
                <span className="w-3 h-3 rounded bg-red-500 inline-block ml-2"></span> D√©caissements
                <span className="w-3 h-1 bg-primary inline-block ml-2 rounded"></span> Solde
                <span className="ml-4 px-2 py-0.5 bg-gray-100 rounded text-[10px]">Les zones claires = projections</span>
            </div>
            <ResponsiveContainer width="100%" height={320}>
                <ComposedChart data={data}><CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0"/>
                <XAxis dataKey={vue==="mensuel"?"m":"date"} tick={{fontSize:10}} stroke="#94a3b8"/>
                <YAxis tick={{fontSize:10}} stroke="#94a3b8"/>
                <Tooltip content={<CTip/>}/><Legend wrapperStyle={{fontSize:10}}/>
                <Bar dataKey="enc" name="Encaissements" radius={[3,3,0,0]}>
                    {data.map((d,i)=><Cell key={i} fill={d.isFuture?"rgba(16,185,129,0.35)":"#10b981"}/>)}
                </Bar>
                <Bar dataKey="dec" name="D√©caissements" radius={[3,3,0,0]}>
                    {data.map((d,i)=><Cell key={i} fill={d.isFuture?"rgba(239,68,68,0.35)":"#ef4444"}/>)}
                </Bar>
                <Line type="monotone" dataKey="sol" stroke="#1e3a5f" name="Solde" strokeWidth={2.5} dot={{r:3}} strokeDasharray={data.some(d=>d.isFuture)?"":""}/>
                </ComposedChart>
            </ResponsiveContainer>
            {vue==="mensuel"&&<div className="mt-3"><XBtn onClick={()=>xls(TRES,"tresorerie")}/></div>}
        </div>
        <div className="grid md:grid-cols-2 gap-6">
            <div className="bg-white rounded-xl shadow-sm p-5">
                <Sec>Endettement par p√¥le</Sec>
                <div className="space-y-4">
                    <div><div className="flex justify-between text-xs mb-1"><span className="font-medium">H√¥telier</span><span className="font-bold text-red-600">{fM(dH)} ({fP(dH/dT*100,0)})</span></div>
                    <div className="w-full bg-gray-200 rounded-full h-3"><div className="bg-red-500 h-3 rounded-full progress-bar" style={{width:(dH/dT*100)+"%"}}></div></div></div>
                    <div><div className="flex justify-between text-xs mb-1"><span className="font-medium">Immobilier</span><span className="font-bold text-orange-600">{fM(dI)} ({fP(dI/dT*100,0)})</span></div>
                    <div className="w-full bg-gray-200 rounded-full h-3"><div className="bg-orange-400 h-3 rounded-full progress-bar" style={{width:(dI/dT*100)+"%"}}></div></div></div>
                    <div className="pt-2 border-t text-xs flex justify-between"><span className="font-semibold">Dette totale</span><span className="font-bold">{fM(dT)}</span></div>
                </div>
            </div>
            <div className="bg-white rounded-xl shadow-sm p-5">
                <Sec>Remboursements annuels</Sec>
                <div className="space-y-3 text-xs">
                    <div className="flex justify-between p-2 bg-gray-50 rounded"><span>Remb. h√¥telier (K+I)</span><span className="font-bold">{fM(GRP.hot.remb)}</span></div>
                    <div className="flex justify-between p-2 bg-gray-50 rounded"><span>Remb. immobilier</span><span className="font-bold">{fM(GRP.imm.remb)}</span></div>
                    <div className="flex justify-between p-2 bg-primary text-white rounded"><span>Total remboursements</span><span className="font-bold">{fM(GRP.cons.rembT)}</span></div>
                    <div className="flex justify-between p-2 bg-blue-50 rounded"><span>LTV h√¥telier</span><span className="font-bold">{fP(GRP.hot.ltv)}</span></div>
                    <div className="flex justify-between p-2 bg-blue-50 rounded"><span>LTV immobilier</span><span className="font-bold">{fP(GRP.imm.ltv)}</span></div>
                </div>
            </div>
        </div>
        {minSol<1500&&<div className="p-3 bg-red-50 rounded-lg text-xs font-medium text-red-700 flex items-center gap-2">{Ic.wrn} Solde minimum √† {fK(minSol)} ‚Äî pr√©voir ligne de cr√©dit court terme</div>}
    </div>);
};

// ===== 6. COUTS PAGE =====
const CoutsPage=()=>{
    const chTotal=H.reduce((s,h)=>s+h.ch,0);
    const coutParCh=Math.round(BDG.chg.t/chTotal*10)/10;
    const costData=BDG.chg.d.map(d=>({name:d.l,value:d.m,pct:d.p}));
    const franData=[];
    const enseignes=[...new Set(H.map(h=>h.ens))];
    enseignes.forEach(e=>{const hs=H.filter(h=>h.ens===e);const ca=hs.reduce((s,h)=>s+h.ca,0);const ch=hs.reduce((s,h)=>s+h.ch,0);
        const txFr=e==="Accor"?0.12:e==="Louvre Hotels"?0.10:0.08;
        franData.push({name:e,hotels:hs.length,ch,ca,franchise:Math.round(ca*txFr),txFr:Math.round(txFr*100)});
    });
    const ccData=H.map(h=>({name:h.n.replace(/^(Ibis Styles |Ibis Budget |Ibis |Premi√®re Classe |Campanile |Mercure |B&B )/,"").substring(0,15),cc:h.cc})).sort((a,b)=>b.cc-a.cc);
    return(<div className="slide-enter space-y-6">
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
            <KPI label="Charges totales" value={fM(BDG.chg.t)} color="danger" icon={Ic.chrt}/>
            <KPI label="Co√ªt/chambre/an" value={coutParCh+" K‚Ç¨"} color="warning"/>
            <KPI label="Masse salariale" value={fP(54.5)} color="primary"/>
            <KPI label="GOP Budget" value={fM(BDG.gop)} color="success"/>
        </div>
        <div className="grid md:grid-cols-2 gap-6">
            <div className="bg-white rounded-xl shadow-sm p-5">
                <Sec>Structure des co√ªts</Sec>
                <ResponsiveContainer width="100%" height={250}>
                    <PieChart><Pie data={costData} dataKey="value" nameKey="name" cx="50%" cy="50%" outerRadius={85} label={({name,percent})=>name.substring(0,10)+" "+Math.round(percent*100)+"%"} labelLine={false} fontSize={10}>
                    {costData.map((d,i)=><Cell key={i} fill={COLS[i]}/>)}</Pie><Tooltip/></PieChart>
                </ResponsiveContainer>
            </div>
            <div className="bg-white rounded-xl shadow-sm p-5">
                <Sec>Co√ªt complet / chambre / nuit (‚Ç¨)</Sec>
                <ResponsiveContainer width="100%" height={250}>
                    <BarChart data={ccData} layout="vertical"><CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0"/>
                    <XAxis type="number" tick={{fontSize:10}} stroke="#94a3b8"/>
                    <YAxis dataKey="name" type="category" width={100} tick={{fontSize:9}} stroke="#94a3b8"/>
                    <Tooltip/><Bar dataKey="cc" fill="#1e3a5f" name="‚Ç¨/ch/nuit" radius={[0,4,4,0]}/></BarChart>
                </ResponsiveContainer>
            </div>
        </div>
        <div className="bg-white rounded-xl shadow-sm p-4">
            <Sec>Analyse franchise par enseigne</Sec>
            <div className="overflow-x-auto"><table className="w-full text-xs">
                <thead className="bg-gray-50"><tr>{["Enseigne","H√¥tels","Chambres","CA (K‚Ç¨)","Taux franchise","Franchise est. (K‚Ç¨)"].map(h=><th key={h} className="p-2 text-left text-muted font-medium">{h}</th>)}</tr></thead>
                <tbody>{franData.map(f=><tr key={f.name} className="border-t border-gray-100">
                    <td className="p-2 font-semibold">{f.name}</td><td className="p-2">{f.hotels}</td><td className="p-2">{f.ch}</td>
                    <td className="p-2">{fmt(f.ca)}</td><td className="p-2">{f.txFr}%</td><td className="p-2 font-bold">{fmt(f.franchise)}</td>
                </tr>)}</tbody>
            </table></div>
        </div>
        <div className="bg-white rounded-xl shadow-sm p-4">
            <Sec>D√©tail charges budget 2026 (K‚Ç¨)</Sec>
            <div className="space-y-2">{BDG.chg.d.map(d=><div key={d.l} className="flex items-center gap-3">
                <span className="text-xs w-28 font-medium">{d.l}</span>
                <div className="flex-1 bg-gray-200 rounded-full h-4"><div className="h-4 rounded-full progress-bar flex items-center pl-2 text-white text-[10px] font-medium" style={{width:Math.max(d.p*2,8)+"%",background:d.p>30?"#ef4444":d.p>10?"#f59e0b":"#10b981"}}>{d.p}%</div></div>
                <span className="text-xs font-bold w-20 text-right">{fmt(d.m)} K‚Ç¨</span>
            </div>)}</div>
        </div>
    </div>);
};

// ===== 7. IMMOBILIERE PAGE =====
const ImmobilierePage=()=>{
    const im=IMM;
    return(<div className="slide-enter space-y-6">
        <div className="grid grid-cols-2 md:grid-cols-5 gap-4">
            <KPI label="Surface totale" value={fmt(im.surf)+" m¬≤"} color="primary" icon={Ic.bld}/>
            <KPI label="Valorisation" value={fM(im.val)} color="secondary"/>
            <KPI label="Loyers bruts" value={fM(im.loyB)} color="success"/>
            <KPI label="Taux capitalisation" value={fP(im.txC)} color="warning"/>
            <KPI label="LTV" value={fP(im.ltv)} color={im.ltv<50?"success":"danger"}/>
        </div>
        <div className="grid md:grid-cols-3 gap-6">
            <div className="bg-white rounded-xl shadow-sm p-5">
                <Sec>Par type de bien</Sec>
                <ResponsiveContainer width="100%" height={220}>
                    <PieChart><Pie data={im.pTyp} dataKey="v" nameKey="n" cx="50%" cy="50%" outerRadius={75} label={({name,value})=>name+" "+value+"%"} labelLine={false} fontSize={9}>
                    {im.pTyp.map((d,i)=><Cell key={i} fill={d.c}/>)}</Pie><Tooltip/></PieChart>
                </ResponsiveContainer>
            </div>
            <div className="bg-white rounded-xl shadow-sm p-5">
                <Sec>Par type de client</Sec>
                <ResponsiveContainer width="100%" height={220}>
                    <PieChart><Pie data={im.pCli} dataKey="v" nameKey="n" cx="50%" cy="50%" outerRadius={75} label={({name,value})=>name+" "+value+"%"} labelLine={false} fontSize={9}>
                    {im.pCli.map((d,i)=><Cell key={i} fill={d.c}/>)}</Pie><Tooltip/></PieChart>
                </ResponsiveContainer>
            </div>
            <div className="bg-white rounded-xl shadow-sm p-5">
                <Sec>Par localisation</Sec>
                <ResponsiveContainer width="100%" height={220}>
                    <PieChart><Pie data={im.pLoc} dataKey="v" nameKey="n" cx="50%" cy="50%" outerRadius={75} label={({name,value})=>name+" "+value+"%"} labelLine={false} fontSize={9}>
                    {im.pLoc.map((d,i)=><Cell key={i} fill={d.c}/>)}</Pie><Tooltip/></PieChart>
                </ResponsiveContainer>
            </div>
        </div>
        <div className="bg-white rounded-xl shadow-sm p-4">
            <Sec right={<XBtn onClick={()=>xls(im.actifs.map(a=>({Localisation:a.l,Type:a.t,Surface_m2:a.s,Locataire:a.loc,Acquisition:a.a})),"immobilier")}/>}>Portefeuille immobilier ‚Äî {im.actifs.length} actifs</Sec>
            <div className="overflow-x-auto"><table className="w-full text-xs">
                <thead className="bg-gray-50"><tr>{["#","Localisation","Type de bien","Surface","Locataire/Usage","Acquisition"].map(h=><th key={h} className="p-2 text-left text-muted font-medium">{h}</th>)}</tr></thead>
                <tbody>{im.actifs.map((a,i)=><tr key={i} className="border-t border-gray-100 hover:bg-gray-50">
                    <td className="p-2 text-muted">{i+1}</td><td className="p-2 font-medium">{a.l}</td><td className="p-2">{a.t}</td>
                    <td className="p-2">{a.s>0?fmt(a.s)+" m¬≤":"‚Äî"}</td><td className="p-2">{a.loc}</td><td className="p-2 text-muted">{a.a}</td>
                </tr>)}</tbody>
            </table></div>
        </div>
        <div className="grid md:grid-cols-3 gap-4 text-xs">
            <div className="bg-white rounded-xl shadow-sm p-4"><div className="text-muted mb-1">Loyers nets</div><div className="text-xl font-bold">{fM(im.loyN)}</div><div className="text-muted">Rendement net : {fP((im.loyN/im.val)*100)}</div></div>
            <div className="bg-white rounded-xl shadow-sm p-4"><div className="text-muted mb-1">Dette immobili√®re</div><div className="text-xl font-bold text-red-600">{fM(im.det)}</div><div className="text-muted">Remb. annuel : {fM(im.remb)}</div></div>
            <div className="bg-white rounded-xl shadow-sm p-4"><div className="text-muted mb-1">DSCR</div><div className="text-xl font-bold text-green-600">{fP(im.dscr)}</div><div className="text-muted">{im.dscr>=120?"Confortable":"Vigilance"} (seuil : 120%)</div></div>
        </div>
    </div>);
};

// ===== 8. BUDGET PAGE =====
const BudgetPage=()=>{
    const [simADR,setSimADR]=useState(0);
    const [simTO,setSimTO]=useState(0);
    const adrF=1+simADR/100,toF=1+simTO/70;
    const simRev=Math.round(BDG.rev.t*adrF*toF);
    const simGOP=simRev-BDG.chg.t;
    const simRN=Math.round(simGOP-(BDG.gop-BDG.rn));
    const revData=[{name:"H√©bergement",value:BDG.rev.heb.t,color:"#1e3a5f"},{name:"F&B",value:BDG.rev.fb.t,color:"#d4a853"},{name:"Autres",value:BDG.rev.aut.t,color:"#10b981"}];
    const mData=MCB.map(m=>({m:m.m,bg:m.bg,ca:m.ca}));
    return(<div className="slide-enter space-y-6">
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
            <KPI label="Revenus budget" value={fM(BDG.rev.t)} color="primary" icon={Ic.calc}/>
            <KPI label="Charges budget" value={fM(BDG.chg.t)} color="danger"/>
            <KPI label="GOP budget" value={fM(BDG.gop)} color="success"/>
            <KPI label="R√©sultat net" value={fM(BDG.rn)} color="secondary"/>
        </div>
        <div className="grid md:grid-cols-2 gap-6">
            <div className="bg-white rounded-xl shadow-sm p-5">
                <Sec>Revenus par p√¥le</Sec>
                <ResponsiveContainer width="100%" height={220}>
                    <PieChart><Pie data={revData} dataKey="value" nameKey="name" cx="50%" cy="50%" outerRadius={75} label={({name,value})=>name+" "+fK(value)} labelLine={false} fontSize={10}>
                    {revData.map((d,i)=><Cell key={i} fill={d.color}/>)}</Pie><Tooltip/></PieChart>
                </ResponsiveContainer>
                <div className="space-y-1 mt-3 text-xs">
                    {BDG.rev.heb.d.map(r=><div key={r.l} className="flex justify-between text-muted"><span>{r.l}</span><span className="font-medium text-gray-700">{fmt(r.m)} K‚Ç¨</span></div>)}
                </div>
            </div>
            <div className="bg-white rounded-xl shadow-sm p-5">
                <Sec>Budget vs R√©alis√© mensuel</Sec>
                <ResponsiveContainer width="100%" height={250}>
                    <ComposedChart data={mData}><CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0"/>
                    <XAxis dataKey="m" tick={{fontSize:11}} stroke="#94a3b8"/>
                    <YAxis tick={{fontSize:11}} stroke="#94a3b8"/>
                    <Tooltip content={<CTip/>}/>
                    <Bar dataKey="ca" fill="#1e3a5f" name="R√©alis√©" radius={[4,4,0,0]}/>
                    <Line type="monotone" dataKey="bg" stroke="#d4a853" name="Budget" strokeWidth={2} dot={false}/>
                    </ComposedChart>
                </ResponsiveContainer>
            </div>
        </div>
        <div className="bg-white rounded-xl shadow-sm p-5 border-2 border-secondary">
            <Sec>Simulation Budget ‚Äî Impact ADR & TO</Sec>
            <div className="grid md:grid-cols-2 gap-6">
                <div className="space-y-4">
                    <div>
                        <div className="flex justify-between text-xs mb-1"><span className="font-medium">Variation ADR</span><span className={"font-bold "+(simADR>=0?"text-green-600":"text-red-600")}>{simADR>=0?"+":""}{simADR}%</span></div>
                        <input type="range" className="sim-slider" min="-20" max="20" value={simADR} onChange={e=>setSimADR(+e.target.value)}/>
                    </div>
                    <div>
                        <div className="flex justify-between text-xs mb-1"><span className="font-medium">Variation TO</span><span className={"font-bold "+(simTO>=0?"text-green-600":"text-red-600")}>{simTO>=0?"+":""}{simTO} pts</span></div>
                        <input type="range" className="sim-slider" min="-10" max="10" value={simTO} onChange={e=>setSimTO(+e.target.value)}/>
                    </div>
                    <button onClick={()=>{setSimADR(0);setSimTO(0)}} className="text-xs text-primary underline">R√©initialiser</button>
                </div>
                <div className="grid grid-cols-3 gap-3 text-center">
                    <div className="bg-blue-50 rounded-xl p-3">
                        <div className="text-xs text-muted">Revenus simul√©s</div>
                        <div className={"text-lg font-bold "+(simRev>=BDG.rev.t?"text-green-600":"text-red-600")}>{fM(simRev)}</div>
                        <div className="text-xs text-muted">Budget: {fM(BDG.rev.t)}</div>
                    </div>
                    <div className="bg-green-50 rounded-xl p-3">
                        <div className="text-xs text-muted">GOP simul√©</div>
                        <div className={"text-lg font-bold "+(simGOP>=BDG.gop?"text-green-600":"text-red-600")}>{fM(simGOP)}</div>
                        <div className="text-xs text-muted">Budget: {fM(BDG.gop)}</div>
                    </div>
                    <div className="bg-yellow-50 rounded-xl p-3">
                        <div className="text-xs text-muted">RN simul√©</div>
                        <div className={"text-lg font-bold "+(simRN>=BDG.rn?"text-green-600":"text-red-600")}>{fM(simRN)}</div>
                        <div className="text-xs text-muted">Budget: {fM(BDG.rn)}</div>
                    </div>
                </div>
            </div>
        </div>
        <div className="bg-white rounded-xl shadow-sm p-4">
            <Sec>CAPEX 2026</Sec>
            <div className="overflow-x-auto"><table className="w-full text-xs">
                <thead className="bg-gray-50"><tr><th className="p-2 text-left text-muted">Poste</th><th className="p-2 text-right text-muted">Montant (K‚Ç¨)</th><th className="p-2 text-right text-muted">% total</th></tr></thead>
                <tbody>{BDG.cpx.d.map(c=><tr key={c.l} className="border-t border-gray-100"><td className="p-2 font-medium">{c.l}</td>
                <td className="p-2 text-right font-semibold">{fmt(c.m)}</td><td className="p-2 text-right text-muted">{Math.round(c.m/BDG.cpx.t*100)}%</td></tr>)}
                <tr className="border-t-2 border-gray-300 bg-gray-50"><td className="p-2 font-bold">Total CAPEX</td><td className="p-2 text-right font-bold">{fmt(BDG.cpx.t)} K‚Ç¨</td><td className="p-2 text-right font-bold">100%</td></tr>
                </tbody></table></div>
        </div>
    </div>);
};

// ===== 9. ETABLISSEMENTS PAGE (PORTFOLIO) =====
const EtablissementsPage=()=>{
    const mRef=useRef(null);const mInst=useRef(null);
    const markersRef=useRef({hotels:[],nonExpl:[],pipeline:[],immo:[]});
    const [filtre,setFiltre]=useState("tous");
    const [panel,setPanel]=useState(null);
    const [tri,setTri]=useState("ca");
    const [ensF,setEnsF]=useState("all");
    const enseignes=[...new Set(H.map(h=>h.ens))];

    const filteredH=useMemo(()=>{
        let list=[...H];if(ensF!=="all")list=list.filter(h=>h.ens===ensF);
        return list.sort((a,b)=>tri==="ca"?b.ca-a.ca:tri==="to"?b.to-a.to:tri==="rp"?b.rp-a.rp:b.ch-a.ch);
    },[ensF,tri]);

    const immGeo={"Forbach":[49.188,6.905],"Metz":[49.119,6.176],"Metz Amphith√©√¢tre":[49.109,6.183],"Ars-Laquenexy":[49.078,6.285],"Jouy-aux-Arches":[49.065,6.078],"Manom":[49.348,6.159],"Sarreguemines":[49.110,7.069],"Ch√¢lons":[48.957,4.363],"Tassin":[45.764,4.762],"Castres":[43.605,2.242]};

    useEffect(()=>{
        if(mInst.current){mInst.current.remove();mInst.current=null;}
        const map=L.map(mRef.current).setView([48.5,5.5],7);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:''}).addTo(map);
        const mkIcon=(color,label)=>L.divIcon({className:'',html:'<div style="background:'+color+';color:white;width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:bold;border:2px solid white;box-shadow:0 2px 8px rgba(0,0,0,.3);cursor:pointer">'+label+'</div>'});
        const mr=markersRef.current;
        H.forEach(h=>{const m=L.marker([h.lat,h.lng],{icon:mkIcon('#1e3a5f',h.e+'‚òÖ')}).addTo(map);m.on('click',()=>setPanel({type:'hotel',data:h}));mr.hotels.push(m);});
        H_NON_EXPL.forEach(h=>{const m=L.marker([h.lat,h.lng],{icon:mkIcon('#94a3b8','M')}).addTo(map);m.on('click',()=>setPanel({type:'nonexpl',data:h}));mr.nonExpl.push(m);});
        PIPELINE.forEach(h=>{const m=L.marker([h.lat,h.lng],{icon:mkIcon('#10b981','P')}).addTo(map);m.on('click',()=>setPanel({type:'pipeline',data:h}));mr.pipeline.push(m);});
        IMM.actifs.forEach((a,i)=>{const geo=immGeo[a.l];if(geo){const m=L.marker([geo[0]+(i%5-2)*0.003,geo[1]+(Math.floor(i/5)-1)*0.004],{icon:mkIcon('#d4a853','I')}).addTo(map);m.on('click',()=>setPanel({type:'immo',data:a}));mr.immo.push(m);}});
        mInst.current=map;setTimeout(()=>map.invalidateSize(),200);
    },[]);

    useEffect(()=>{
        const mr=markersRef.current;const map=mInst.current;if(!map)return;
        const show=(arr,vis)=>arr.forEach(m=>{if(vis)m.addTo(map);else map.removeLayer(m);});
        show(mr.hotels,filtre==="tous"||filtre==="hotels");
        show(mr.nonExpl,filtre==="tous"||filtre==="hotels");
        show(mr.pipeline,filtre==="tous"||filtre==="hotels");
        show(mr.immo,filtre==="tous"||filtre==="immo");
    },[filtre]);

    return(<div className="slide-enter space-y-5">
        <div className="flex flex-wrap items-center gap-2">
            <span className="text-xs font-medium text-muted">Carte :</span>
            {[["tous","Tous"],["hotels","H√¥tels"],["immo","Immobilier"]].map(([k,l])=>
                <button key={k} onClick={()=>setFiltre(k)} className={"px-3 py-1 rounded-full text-xs font-semibold "+(filtre===k?"bg-primary text-white shadow":"bg-gray-100 text-gray-600")}>{l}</button>)}
            <div className="flex gap-2 ml-auto text-[10px] text-muted">
                <span className="flex items-center gap-1"><span className="w-2.5 h-2.5 rounded-full" style={{background:'#1e3a5f'}}></span>{H.length} h√¥tels</span>
                <span className="flex items-center gap-1"><span className="w-2.5 h-2.5 rounded-full" style={{background:'#94a3b8'}}></span>{H_NON_EXPL.length} murs</span>
                <span className="flex items-center gap-1"><span className="w-2.5 h-2.5 rounded-full" style={{background:'#10b981'}}></span>{PIPELINE.length} pipeline</span>
                <span className="flex items-center gap-1"><span className="w-2.5 h-2.5 rounded-full" style={{background:'#d4a853'}}></span>{IMM.actifs.length} immo</span>
            </div>
        </div>
        <div ref={mRef} style={{height:"380px"}} className="rounded-xl shadow-sm border border-gray-200"></div>

        <div className="flex flex-wrap items-center gap-2">
            <span className="text-xs font-medium text-muted">H√¥tels :</span>
            <button onClick={()=>setEnsF("all")} className={"px-3 py-1 rounded-full text-xs font-medium "+(ensF==="all"?"bg-secondary text-white":"bg-gray-100 text-gray-600")}>Tous ({H.length})</button>
            {enseignes.map(e=><button key={e} onClick={()=>setEnsF(e)} className={"px-3 py-1 rounded-full text-xs font-medium "+(ensF===e?"bg-secondary text-white":"bg-gray-100 text-gray-600")}>{e} ({H.filter(h=>h.ens===e).length})</button>)}
            <div className="ml-auto flex gap-1">
                {[["ca","CA"],["to","TO"],["rp","RevPAR"],["ch","Ch."]].map(([k,l])=><button key={k} onClick={()=>setTri(k)} className={"px-2 py-1 rounded text-[11px] "+(tri===k?"bg-primary text-white":"bg-gray-100 text-gray-600")}>{l}</button>)}
            </div>
        </div>

        <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
            {filteredH.map(h=><div key={h.id} onClick={()=>setPanel({type:'hotel',data:h})} className="hotel-card bg-white rounded-xl shadow-sm p-3 border-l-4 cursor-pointer" style={{borderLeftColor:h.e>=4?"#d4a853":h.e>=3?"#1e3a5f":h.e>=2?"#10b981":"#94a3b8"}}>
                <h4 className="font-bold text-xs truncate">{h.n}</h4>
                <p className="text-[10px] text-muted">{h.v} ¬∑ {"‚òÖ".repeat(h.e)} ¬∑ {h.ch} ch.</p>
                <div className="grid grid-cols-3 gap-1 mt-2 text-[10px] text-center">
                    <div className="bg-gray-50 rounded p-1"><span className="text-muted block">TO</span><span className="font-bold">{h.to}%</span></div>
                    <div className="bg-gray-50 rounded p-1"><span className="text-muted block">ADR</span><span className="font-bold">{h.adr}‚Ç¨</span></div>
                    <div className="bg-gray-50 rounded p-1"><span className="text-muted block">CA</span><span className="font-bold">{fK(h.ca)}</span></div>
                </div>
                {h.lab.length>0&&<div className="flex gap-0.5 mt-1.5">{h.lab.map(l=><span key={l} className="text-[8px] px-1 py-0.5 bg-green-100 text-green-700 rounded-full">{l}</span>)}</div>}
            </div>)}
        </div>

        <div className={"side-overlay"+(panel?" open":"")} onClick={()=>setPanel(null)}></div>
        <div className={"side-panel"+(panel?" open":"")}>
            {panel&&<div className="p-6">
                <button onClick={()=>setPanel(null)} className="absolute top-4 right-4 w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-500 hover:bg-gray-200 text-lg font-bold">√ó</button>
                {panel.type==="hotel"&&<div>
                    <span className="text-xs text-muted">{panel.data.ens} ¬∑ {panel.data.fr}</span>
                    <h2 className="text-lg font-bold text-primary mt-1">{panel.data.n}</h2>
                    <p className="text-sm text-muted">{panel.data.v} ¬∑ {"‚òÖ".repeat(panel.data.e)}</p>
                    <div className="grid grid-cols-3 gap-3 my-4">
                        <div className="bg-blue-50 rounded-lg p-3 text-center"><div className="text-[10px] text-muted">Chambres</div><div className="text-lg font-bold text-primary">{panel.data.ch}</div></div>
                        <div className="bg-green-50 rounded-lg p-3 text-center"><div className="text-[10px] text-muted">TO</div><div className="text-lg font-bold text-green-600">{panel.data.to}%</div></div>
                        <div className="bg-yellow-50 rounded-lg p-3 text-center"><div className="text-[10px] text-muted">CA</div><div className="text-lg font-bold text-yellow-700">{fK(panel.data.ca)}</div></div>
                    </div>
                    <div className="space-y-1.5 text-xs border-t pt-3">
                        {[["ADR",panel.data.adr+" ‚Ç¨"],["RevPAR",panel.data.rp+" ‚Ç¨"],["GOP",panel.data.gp+"%"],["Co√ªt/nuit",panel.data.cc+" ‚Ç¨"]].map(([k,v])=><div key={k} className="flex justify-between"><span className="text-muted">{k}</span><span className="font-semibold">{v}</span></div>)}
                    </div>
                    <div className="space-y-1.5 text-xs border-t pt-3 mt-3">
                        {[["Propri√©t√©",panel.data.prop],["Acquisition",panel.data.acq]].map(([k,v])=><div key={k} className="flex justify-between"><span className="text-muted">{k}</span><span className="font-semibold">{v}</span></div>)}
                        {panel.data.reno!=="‚Äî"&&<div className="flex justify-between"><span className="text-muted">R√©novation</span><span className="font-semibold">{panel.data.reno}</span></div>}
                    </div>
                    <div className="space-y-1.5 text-xs border-t pt-3 mt-3">
                        <div className="flex justify-between"><span className="text-muted">Directeur</span><span className="font-bold">{panel.data.dir}</span></div>
                        <div className="flex justify-between"><span className="text-muted">T√©l√©phone</span><span className="font-semibold">{panel.data.tel}</span></div>
                    </div>
                    {panel.data.lab.length>0&&<div className="mt-3 pt-3 border-t"><span className="text-xs text-muted block mb-1">Labels RSE</span><div className="flex flex-wrap gap-1">{panel.data.lab.map(l=><span key={l} className="text-xs px-2 py-0.5 bg-green-100 text-green-700 rounded-full">{l}</span>)}</div></div>}
                    <div className="mt-3 pt-3 border-t"><span className="text-xs text-muted block mb-1">√âquipements</span><div className="flex flex-wrap gap-1">{panel.data.eq.map(e=><span key={e} className="text-xs px-2 py-0.5 bg-gray-100 text-gray-700 rounded-full">{e}</span>)}</div></div>
                </div>}
                {panel.type==="immo"&&<div>
                    <span className="text-xs text-muted">Actif immobilier</span>
                    <h2 className="text-lg font-bold text-secondary mt-1">{panel.data.t}</h2>
                    <p className="text-sm text-muted mb-4">{panel.data.l}</p>
                    <div className="space-y-2 text-xs">
                        {panel.data.s>0&&<div className="flex justify-between p-2 bg-gray-50 rounded"><span className="text-muted">Surface</span><span className="font-semibold">{fmt(panel.data.s)} m¬≤</span></div>}
                        <div className="flex justify-between p-2 bg-gray-50 rounded"><span className="text-muted">Locataire</span><span className="font-semibold text-right max-w-[200px]">{panel.data.loc}</span></div>
                        <div className="flex justify-between p-2 bg-gray-50 rounded"><span className="text-muted">Acquisition</span><span className="font-semibold">{panel.data.a}</span></div>
                    </div>
                </div>}
                {panel.type==="nonexpl"&&<div>
                    <span className="text-xs text-muted">Murs non exploit√©s</span>
                    <h2 className="text-lg font-bold mt-1">{panel.data.n}</h2>
                    <p className="text-sm text-muted mb-4">{panel.data.v}</p>
                    <div className="space-y-2 text-xs">
                        {[["Chambres",panel.data.ch],["Propri√©t√©",panel.data.prop],["Livraison",panel.data.liv],["Exploitant",panel.data.expl]].map(([k,v])=><div key={k} className="flex justify-between p-2 bg-gray-50 rounded"><span className="text-muted">{k}</span><span className="font-semibold">{v}</span></div>)}
                    </div>
                </div>}
                {panel.type==="pipeline"&&<div>
                    <span className="text-xs text-muted">Projet pipeline</span>
                    <h2 className="text-lg font-bold text-green-700 mt-1">{panel.data.n}</h2>
                    <p className="text-sm text-muted mb-4">{panel.data.v}</p>
                    <div className="space-y-2 text-xs">
                        {[["Chambres",panel.data.ch],["Statut",panel.data.stat],["√âch√©ance",panel.data.ech]].map(([k,v])=><div key={k} className="flex justify-between p-2 bg-gray-50 rounded"><span className="text-muted">{k}</span><span className="font-semibold">{v}</span></div>)}
                        <div className="flex justify-between p-2 bg-green-50 rounded"><span className="text-muted">CA pr√©visionnel</span><span className="font-bold text-green-700">{fK(panel.data.caP)}</span></div>
                    </div>
                </div>}
            </div>}
        </div>
    </div>);
};

// ===== 10. ROADMAP PAGE =====
const RoadmapPage=()=>{
    const totBud=RDM.reduce((s,p)=>s+p.bud,0);
    const totDep=RDM.reduce((s,p)=>s+p.dep,0);
    const totCH=RDM.filter(p=>p.ch).reduce((s,p)=>s+p.ch,0);
    const totCAP=RDM.filter(p=>p.caP).reduce((s,p)=>s+p.caP,0);
    const stColors={"En cours":"#3b82f6","Planifi√©":"#94a3b8","√âtude":"#8b5cf6"};
    return(<div className="slide-enter space-y-6">
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
            <KPI label="Budget total projets" value={fM(totBud)} color="primary" icon={Ic.clip}/>
            <KPI label="D√©pens√©" value={fM(totDep)} color="warning"/>
            <KPI label="Chambres impact√©es" value={fmt(totCH)} color="secondary"/>
            <KPI label="CA pr√©visionnel" value={fM(totCAP)} color="success"/>
        </div>
        <div className="bg-white rounded-xl shadow-sm p-4">
            <Sec right={<XBtn onClick={()=>xls(RDM.map(p=>({Projet:p.nom,Type:p.typ,Budget_K:p.bud,Depense_K:p.dep,Progression:p.prg+"%",Responsable:p.resp,Echeance:p.ech,Statut:p.st})),"roadmap")}/>}>Projets ({RDM.length})</Sec>
            <div className="space-y-4">
                {RDM.map(p=><div key={p.id} className="border border-gray-200 rounded-xl p-4 hover:shadow-md transition-shadow">
                    <div className="flex items-start justify-between mb-2">
                        <div><h4 className="font-bold text-sm">{p.nom}</h4><p className="text-xs text-muted">{p.typ} ¬∑ Resp: {p.resp} ¬∑ √âch√©ance: {p.ech}</p></div>
                        <Bdg statut={p.st}/>
                    </div>
                    <div className="flex items-center gap-3 mb-2">
                        <div className="flex-1 bg-gray-200 rounded-full h-3">
                            <div className="h-3 rounded-full progress-bar" style={{width:p.prg+"%",background:stColors[p.st]||"#94a3b8"}}></div>
                        </div>
                        <span className="text-xs font-bold w-12 text-right">{p.prg}%</span>
                    </div>
                    <div className="flex flex-wrap gap-4 text-xs text-muted">
                        <span>Budget: <strong className="text-gray-700">{fK(p.bud)}</strong></span>
                        <span>D√©pens√©: <strong className="text-gray-700">{fK(p.dep)}</strong></span>
                        {p.ch&&<span>Chambres: <strong className="text-gray-700">{p.ch}</strong></span>}
                        {p.caP&&<span>CA pr√©v.: <strong className="text-green-600">{fK(p.caP)}</strong></span>}
                        {p.rsk&&<span className="text-orange-600 font-medium">Risque: {p.rsk}</span>}
                    </div>
                </div>)}
            </div>
        </div>
        <div className="bg-white rounded-xl shadow-sm p-5">
            <Sec>Avancement global</Sec>
            <ResponsiveContainer width="100%" height={250}>
                <BarChart data={RDM.map(p=>({name:p.nom.substring(0,20),prg:p.prg,bud:p.bud/100}))} layout="vertical">
                <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0"/>
                <XAxis type="number" domain={[0,100]} tick={{fontSize:10}} stroke="#94a3b8"/>
                <YAxis dataKey="name" type="category" width={140} tick={{fontSize:9}} stroke="#94a3b8"/>
                <Tooltip/><Bar dataKey="prg" fill="#3b82f6" name="% avancement" radius={[0,4,4,0]}/></BarChart>
            </ResponsiveContainer>
        </div>
    </div>);
};

// ===== 11. ORGANIGRAMME PAGE =====
const OrganigrammePage=()=>{
    return(<div className="slide-enter space-y-6">
        <div className="bg-white rounded-xl shadow-sm p-6 text-center">
            <h3 className="text-lg font-bold text-primary mb-1">Direction G√©n√©rale</h3>
            <div className="flex justify-center gap-6 mt-3">
                {ORG.dir.map(d=><div key={d.n} className="org-node bg-primary text-white rounded-xl px-6 py-4 shadow-lg">
                    <div className="font-bold text-sm">{d.n}</div><div className="text-xs text-blue-200">{d.p}</div>
                </div>)}
            </div>
        </div>
        <div className="bg-white rounded-xl shadow-sm p-5">
            <h4 className="text-sm font-bold text-gray-700 mb-3">Support Direction</h4>
            <div className="flex flex-wrap justify-center gap-3">
                {ORG.sup.map(s=><div key={s.n} className="org-node bg-gray-100 rounded-lg px-4 py-2.5 text-center text-xs">
                    <div className="font-semibold">{s.n}</div><div className="text-muted">{s.p}</div>
                </div>)}
            </div>
        </div>
        <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3">
            {ORG.dep.map(dep=>{const hl=dep.isNew||dep.hasNew;return <div key={dep.nm} className={"org-node bg-white rounded-xl shadow-sm p-3 border-t-4 "+(hl?"ring-2 ring-green-400 ring-offset-2":"")} style={{borderTopColor:dep.col}}>
                <div className="flex items-center justify-between mb-1.5">
                    <h4 className="font-bold text-xs" style={{color:dep.col}}>{dep.nm}</h4>
                    {hl&&<span className="text-[9px] bg-green-500 text-white px-1.5 py-0.5 rounded-full font-bold animate-pulse">Nouveau !</span>}
                </div>
                <div className={"rounded-lg p-2 mb-1.5 "+(hl?"bg-green-50 border border-green-200":"bg-gray-50")}>
                    <div className={"font-bold text-xs "+(hl?"text-green-700":"")}>{dep.r}</div>
                    <div className="text-[11px] text-muted">{dep.p}</div>
                </div>
                {dep.eq.length>0&&<div className="space-y-1 mt-1.5">
                    {dep.eq.map(e=><div key={e.n} className={"flex items-center gap-1.5 text-[11px] p-1 rounded "+(e.isNew?"bg-green-50 border border-green-200":"bg-gray-50")}>
                        <div className="w-5 h-5 rounded-full flex items-center justify-center text-white text-[8px] font-bold flex-shrink-0" style={{background:e.isNew?"#10b981":dep.col}}>{e.n.split(' ').map(w=>w[0]).join('')}</div>
                        <div className="min-w-0"><div className={"font-medium truncate "+(e.isNew?"text-green-700":"")}>{e.n}</div><div className="text-muted text-[10px] truncate">{e.p}</div>{e.isNew&&<span className="text-[8px] bg-green-500 text-white px-1 py-0.5 rounded-full font-bold">Nouveau !</span>}</div>
                    </div>)}
                </div>}
                {dep.eq.length===0&&!hl&&<div className="text-[11px] text-muted italic mt-1">Pas de collaborateur</div>}
            </div>})}
        </div>
        <div className="bg-white rounded-xl shadow-sm p-4 text-center text-xs text-muted">
            <strong>{ORG.dep.reduce((s,d)=>s+1+d.eq.length,0)+ORG.dir.length+ORG.sup.length}</strong> collaborateurs si√®ge ¬∑ <strong>14</strong> directeurs d'√©tablissement ¬∑ <strong>~180</strong> ETP exploitation
        </div>
    </div>);
};

// ===== 12. P&L PAGE =====
const PnlPage=()=>{
    const [vue,setVue]=useState("conso");
    const data=vue==="hot"?PNL.hot:vue==="immo"?PNL.immo:PNL.conso;
    const PnlRow=({r,cols})=>{
        if(r.style==="header")return <tr className="bg-gray-100"><td colSpan={cols.length+2} className="px-3 py-2 font-bold text-xs text-primary">{r.l}</td></tr>;
        if(r.style==="spacer")return <tr><td colSpan={cols.length+2} className="py-1"></td></tr>;
        const isTotal=r.style==="total";
        const isSub=r.style==="subtotal";
        const isHL=r.style==="highlight";
        const isRes=r.style==="result";
        const isPct=r.style==="pct";
        const cls=isRes?"bg-primary text-white font-bold":isHL?"bg-blue-50 font-bold":isTotal?"bg-gray-50 font-bold border-t border-gray-300":isSub?"font-semibold":isPct?"italic text-muted":"";
        return <tr className={cls+" text-xs hover:bg-opacity-80"}>
            <td className={"px-3 py-1.5 "+(isPct?"pl-6":"")+(isRes?" rounded-l":"")}>
                {r.l}
            </td>
            {r.v&&r.v.map((v,i)=>{
                const fmtV=isPct?(v>=0?"+":"")+v.toFixed(1)+"%":v<0?"-"+fmt(Math.abs(v)):fmt(v);
                return <td key={i} className={"px-3 py-1.5 text-right tabular-nums "+(v<0&&!isPct?"text-red-600":"")+(isRes?" text-white":"")}>{fmtV}{!isPct&&!isRes?" K‚Ç¨":""}</td>
            })}
            {r.v&&r.v.length>=2&&!isPct&&<td className={"px-3 py-1.5 text-right tabular-nums text-xs "+(isRes?" rounded-r text-white":"")}>
                {r.v[2]!==0&&r.v[1]!==0?((r.v[2]/r.v[1]-1)*100>=0?<span className={isRes?"text-green-200":"text-green-600"}>+{((r.v[2]/r.v[1]-1)*100).toFixed(1)}%</span>:<span className={isRes?"text-red-200":"text-red-600"}>{((r.v[2]/r.v[1]-1)*100).toFixed(1)}%</span>):"‚Äî"}
            </td>}
            {isPct&&<td className="px-3 py-1.5"></td>}
        </tr>;
    };
    return(<div className="slide-enter space-y-6">
        <div className="flex items-center justify-between">
            <h2 className="text-base font-bold text-gray-900">Compte de R√©sultat</h2>
            <div className="flex gap-1">
                {[["conso","Consolid√©"],["hot","H√¥telier"],["immo","Immobilier"]].map(([k,l])=>
                    <button key={k} onClick={()=>setVue(k)} className={"px-4 py-1.5 rounded-lg text-xs font-semibold transition-colors "+(vue===k?"bg-primary text-white shadow":"bg-gray-100 text-gray-600 hover:bg-gray-200")}>{l}</button>
                )}
            </div>
        </div>
        <div className="bg-white rounded-xl shadow-sm overflow-hidden">
            <table className="w-full">
                <thead><tr className="bg-gray-800 text-white text-xs">
                    <th className="px-3 py-2.5 text-left font-semibold">Libell√© (K‚Ç¨)</th>
                    {PNL.cols.map(c=><th key={c} className="px-3 py-2.5 text-right font-semibold">{c}</th>)}
                    <th className="px-3 py-2.5 text-right font-semibold">Var. Bdg/2025</th>
                </tr></thead>
                <tbody>{data.map((r,i)=><PnlRow key={i} r={r} cols={PNL.cols}/>)}</tbody>
            </table>
        </div>
        <div className="flex gap-2">
            <XBtn onClick={()=>{const exp=data.filter(r=>r.v).map(r=>{const o={Libelle:r.l};PNL.cols.forEach((c,i)=>o[c]=r.v[i]);return o;});xls(exp,"pnl_"+vue)}} label="Export P&L"/>
        </div>
        {vue==="conso"&&<div className="grid md:grid-cols-3 gap-4">
            <div className="bg-green-50 rounded-xl p-4 text-center">
                <div className="text-xs text-muted mb-1">EBE Consolid√© Budget 2026</div>
                <div className="text-2xl font-bold text-green-700">{fM(6434)}</div>
                <div className="text-xs text-green-600 mt-1">Marge 23,9%</div>
            </div>
            <div className="bg-blue-50 rounded-xl p-4 text-center">
                <div className="text-xs text-muted mb-1">R√©sultat d'exploitation</div>
                <div className="text-2xl font-bold text-blue-700">{fM(3608)}</div>
                <div className="text-xs text-blue-600 mt-1">+66% vs 2025</div>
            </div>
            <div className="bg-primary rounded-xl p-4 text-center text-white">
                <div className="text-xs text-blue-200 mb-1">R√©sultat Net Consolid√©</div>
                <div className="text-2xl font-bold">{fM(1993)}</div>
                <div className="text-xs text-blue-200 mt-1">Marge nette 7,4%</div>
            </div>
        </div>}
        {vue==="hot"&&<div className="p-3 bg-yellow-50 rounded-lg text-xs text-yellow-800">
            <strong>Note :</strong> Le p√¥le h√¥telier affiche un r√©sultat net n√©gatif en 2024-2025 en raison de la politique d'acquisition intensive (5 h√¥tels acquis 2021-2025) g√©n√©rant d'importants amortissements et charges financi√®res. Le retour √† la profitabilit√© est pr√©vu en 2026 avec la mont√©e en puissance du portefeuille.
        </div>}
        {vue==="immo"&&<div className="p-3 bg-green-50 rounded-lg text-xs text-green-800">
            <strong>Performance :</strong> Le p√¥le immobilier affiche une marge nette stable autour de 44%, avec un rendement locatif net de 76%. Ce p√¥le constitue le socle de rentabilit√© du groupe pendant la phase de croissance h√¥teli√®re.
        </div>}
    </div>);
};

// ===== 12. RSE PAGE =====
const RsePage=()=>{
    const R=RSE_DATA;
    const scopeData=R.carbone.scopes.map(s=>({name:s.l.split("‚Äî")[0].trim(),value:s.v,color:s.c}));
    const stColors={"Fait":"#10b981","En cours":"#3b82f6","Planifi√©":"#f59e0b","√âtude":"#94a3b8"};
    return(<div className="slide-enter space-y-6">
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
            <KPI label="√âmissions CO‚ÇÇ" value={fmt(R.carbone.total)+" tCO‚ÇÇe"} color="danger" trend={-3.4} tl="% vs N-1"/>
            <KPI label="√ânergie" value={fmt(R.energie.conso)+" MWh"} color="warning" trend={-2.4} tl="%"/>
            <KPI label="Eau" value={R.eau.parNuitee+" L/nuit√©e"} color="primary"/>
            <KPI label="Taux de tri" value={R.dechets.tri+"%"} color="success" trend={4} tl=" pts"/>
        </div>

        <div className="grid md:grid-cols-2 gap-6">
            <div className="bg-white rounded-xl shadow-sm p-5">
                <Sec>Bilan Carbone ‚Äî {fmt(R.carbone.total)} tCO‚ÇÇe/an</Sec>
                <ResponsiveContainer width="100%" height={220}>
                    <PieChart><Pie data={scopeData} dataKey="value" nameKey="name" cx="50%" cy="50%" innerRadius={50} outerRadius={80} label={({name,value})=>name+" "+fmt(value)} labelLine={false} fontSize={9}>
                    {scopeData.map((d,i)=><Cell key={i} fill={d.color}/>)}</Pie><Tooltip/></PieChart>
                </ResponsiveContainer>
                <div className="space-y-2 mt-3">{R.carbone.scopes.map(s=><div key={s.l} className="text-xs">
                    <div className="flex justify-between font-medium mb-0.5"><span style={{color:s.c}}>{s.l}</span><span>{fmt(s.v)} tCO‚ÇÇe</span></div>
                    <div className="flex flex-wrap gap-1">{s.detail.map(d=><span key={d.l} className="px-1.5 py-0.5 bg-gray-100 rounded text-[10px]">{d.l}: {fmt(d.v)}</span>)}</div>
                </div>)}</div>
            </div>
            <div className="bg-white rounded-xl shadow-sm p-5">
                <Sec>Trajectoire carbone (tCO‚ÇÇe)</Sec>
                <ResponsiveContainer width="100%" height={220}>
                    <ComposedChart data={R.carbone.evo}><CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0"/>
                    <XAxis dataKey="a" tick={{fontSize:10}} stroke="#94a3b8"/>
                    <YAxis tick={{fontSize:10}} stroke="#94a3b8" domain={[3000,5500]}/>
                    <Tooltip/><ReferenceLine y={R.carbone.objectif2030} stroke="#10b981" strokeDasharray="5 5" label={{value:"Objectif 2030 (‚àí20%)",fontSize:10,fill:"#10b981"}}/>
                    <Bar dataKey="v" name="√âmissions" radius={[4,4,0,0]}>
                    {R.carbone.evo.map((d,i)=><Cell key={i} fill={d.a.includes("Obj")||d.a.includes("P")?"rgba(30,58,95,0.4)":"#1e3a5f"}/>)}</Bar>
                    <Line type="monotone" dataKey="v" stroke="#d4a853" strokeWidth={2} dot={{r:3}}/>
                    </ComposedChart>
                </ResponsiveContainer>
                <div className="mt-3 p-2 bg-green-50 rounded-lg text-xs text-green-700">
                    <strong>{R.carbone.parChambre} tCO‚ÇÇe/chambre</strong> vs benchmark secteur <strong>{R.carbone.benchmark}</strong> ‚Äî <span className="text-green-600 font-bold">‚àí{Math.round((1-R.carbone.parChambre/R.carbone.benchmark)*100)}% sous le benchmark</span>
                </div>
            </div>
        </div>

        <div className="grid md:grid-cols-3 gap-4">
            <div className="bg-white rounded-xl shadow-sm p-4">
                <Sec>√ânergie ‚Äî {fmt(R.energie.kwh_chambre)} kWh/chambre</Sec>
                <ResponsiveContainer width="100%" height={160}>
                    <PieChart><Pie data={R.energie.parType} dataKey="v" nameKey="l" cx="50%" cy="50%" outerRadius={60} label={({l,v})=>l+" "+fmt(v)} labelLine={false} fontSize={9}>
                    {R.energie.parType.map((d,i)=><Cell key={i} fill={d.c}/>)}</Pie><Tooltip/></PieChart>
                </ResponsiveContainer>
                <div className="mt-2"><div className="flex justify-between text-xs mb-1"><span className="text-muted">vs benchmark ({fmt(R.energie.benchmark_chambre)} kWh/chambre)</span><span className="font-bold text-green-600">‚àí{Math.round((1-R.energie.kwh_chambre/R.energie.benchmark_chambre)*100)}%</span></div>
                <div className="w-full bg-gray-200 rounded-full h-2"><div className="bg-green-500 h-2 rounded-full" style={{width:Math.round(R.energie.kwh_chambre/R.energie.benchmark_chambre*100)+"%"}}></div></div></div>
            </div>
            <div className="bg-white rounded-xl shadow-sm p-4">
                <Sec>Eau ‚Äî {R.eau.parNuitee} L/nuit√©e</Sec>
                <div className="flex items-center justify-center my-4">
                    <div className="relative w-28 h-28 rounded-full border-8 border-blue-200 flex items-center justify-center">
                        <div className="text-center"><div className="text-2xl font-bold text-primary">{R.eau.parNuitee}</div><div className="text-[10px] text-muted">L/nuit√©e</div></div>
                        <div className="absolute -bottom-2 text-[10px] bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full">Bench. {R.eau.benchmark}L</div>
                    </div>
                </div>
                <div className="text-xs text-center text-muted">Total annuel : <strong>{fmt(R.eau.total)} m¬≥</strong><br/>Objectif : {R.eau.objectif} L/nuit√©e</div>
            </div>
            <div className="bg-white rounded-xl shadow-sm p-4">
                <Sec>D√©chets ‚Äî {R.dechets.tri}% tri√©s</Sec>
                <ResponsiveContainer width="100%" height={160}>
                    <PieChart><Pie data={R.dechets.parType} dataKey="v" nameKey="l" cx="50%" cy="50%" outerRadius={60} label={({l,v})=>l+" "+v+"%"} labelLine={false} fontSize={8}>
                    {R.dechets.parType.map((d,i)=><Cell key={i} fill={d.c}/>)}</Pie><Tooltip/></PieChart>
                </ResponsiveContainer>
                <div className="mt-2"><div className="flex justify-between text-xs mb-1"><span className="text-muted">Taux de tri</span><span className="font-bold">{R.dechets.tri}% / obj. {R.dechets.objectifTri}%</span></div>
                <div className="w-full bg-gray-200 rounded-full h-2"><div className="bg-green-500 h-2 rounded-full" style={{width:R.dechets.tri+"%"}}></div></div></div>
            </div>
        </div>

        <div className="bg-white rounded-xl shadow-sm p-5">
            <Sec>Labels & Certifications</Sec>
            <div className="grid md:grid-cols-3 gap-4">
                {R.labels.map(l=><div key={l.l} className="p-3 border rounded-xl">
                    <div className="flex items-center justify-between mb-2">
                        <span className="font-bold text-sm" style={{color:l.c}}>{l.l}</span>
                        <span className="text-xs bg-gray-100 px-2 py-0.5 rounded-full">{l.n}/{l.total} sites</span>
                    </div>
                    <div className="w-full bg-gray-200 rounded-full h-3 mb-1">
                        <div className="h-3 rounded-full progress-bar" style={{width:(l.n/l.total*100)+"%",background:l.c}}></div>
                    </div>
                    {l.obj&&<div className="text-[10px] text-muted mt-1">Objectif : {l.obj}</div>}
                </div>)}
            </div>
        </div>

        <div className="bg-white rounded-xl shadow-sm p-5">
            <Sec right={<XBtn onClick={()=>xls(R.actions.map(a=>({Action:a.l,Statut:a.st,Progression:a.prg+"%",Categorie:a.cat,Impact:a.eco})),"rse_actions")} label="Export"/>}>Plan d'actions RSE ({R.actions.length})</Sec>
            <div className="space-y-3">
                {R.actions.map(a=><div key={a.l} className="flex items-center gap-3">
                    <div className="flex-1 min-w-0">
                        <div className="flex items-center gap-2 mb-0.5">
                            <span className="text-xs font-medium truncate">{a.l}</span>
                            <span className="text-[10px] px-1.5 py-0.5 rounded-full font-medium flex-shrink-0" style={{background:stColors[a.st]+"20",color:stColors[a.st]}}>{a.st}</span>
                        </div>
                        <div className="flex items-center gap-2">
                            <div className="flex-1 bg-gray-200 rounded-full h-2"><div className="h-2 rounded-full progress-bar" style={{width:a.prg+"%",background:stColors[a.st]}}></div></div>
                            <span className="text-[10px] font-bold w-8 text-right">{a.prg}%</span>
                        </div>
                    </div>
                    <span className="text-[10px] text-muted w-24 text-right flex-shrink-0">{a.eco}</span>
                </div>)}
            </div>
        </div>
    </div>);
};


// ===== WRAPPER: SYNTH√àSE (Journalier + Vue Globale + Groupe) =====
const SynthesePage=()=>{
    const [vue,setVue]=useState("jour");
    return(<div className="slide-enter space-y-4">
        <div className="flex bg-white rounded-xl shadow-sm p-1 gap-1">
            {[{k:"jour",l:"Journalier"},{k:"mensuel",l:"Vue Mensuelle"},{k:"groupe",l:"Consolid√© Groupe"}].map(v=>
                <button key={v.k} onClick={()=>setVue(v.k)} className={"flex-1 px-3 py-2 rounded-lg text-xs font-medium transition "+(vue===v.k?"bg-primary text-white shadow":"text-gray-600 hover:bg-gray-100")}>{v.l}</button>
            )}
        </div>
        {vue==="jour"&&<DailyPage/>}{vue==="mensuel"&&<GlobalePage/>}{vue==="groupe"&&<GroupePage/>}
    </div>);
};

// ===== WRAPPER: P&L COMPLET (P&L + Co√ªts) =====
const PnlCompletPage=()=>{
    const [vue,setVue]=useState("pnl");
    return(<div className="slide-enter space-y-4">
        <div className="flex bg-white rounded-xl shadow-sm p-1 gap-1">
            {[{k:"pnl",l:"Compte de r√©sultat"},{k:"couts",l:"Analyse des co√ªts"}].map(v=>
                <button key={v.k} onClick={()=>setVue(v.k)} className={"flex-1 px-3 py-2 rounded-lg text-xs font-medium transition "+(vue===v.k?"bg-primary text-white shadow":"text-gray-600 hover:bg-gray-100")}>{v.l}</button>
            )}
        </div>
        {vue==="pnl"?<PnlPage/>:<CoutsPage/>}
    </div>);
};

// ===== WRAPPER: BUDGET & PROJETS =====
const BudgetProjetsPage=()=>{
    const [vue,setVue]=useState("budget");
    return(<div className="slide-enter space-y-4">
        <div className="flex bg-white rounded-xl shadow-sm p-1 gap-1">
            {[{k:"budget",l:"Budget 2026"},{k:"projets",l:"Roadmap & Projets"}].map(v=>
                <button key={v.k} onClick={()=>setVue(v.k)} className={"flex-1 px-3 py-2 rounded-lg text-xs font-medium transition "+(vue===v.k?"bg-primary text-white shadow":"text-gray-600 hover:bg-gray-100")}>{v.l}</button>
            )}
        </div>
        {vue==="budget"?<BudgetPage/>:<RoadmapPage/>}
    </div>);
};

// ===== PILOTAGE CDG PAGE =====
const PilotagePage=()=>{
    const [benchTri,setBenchTri]=useState("caCh");
    const [simTO,setSimTO]=useState(0);
    const totalCA=H.reduce((s,h)=>s+h.ca,0);
    const cm=TODAY.getMonth();

    // --- √âcarts Budget vs R√©el (per-hotel variance) ---
    const ecarts=useMemo(()=>{
        return H.map(h=>{
            const share=h.ca/totalCA;
            const bgYtd=Math.round(MCB.slice(0,cm+1).reduce((s,m)=>s+m.bg,0)*share);
            // Per-hotel performance factor: TO-driven + random seed for realism
            const perfFactor=(h.to/70)*(0.92+(h.id*13+h.ch*7)%17/100);
            const rlYtd=Math.round(bgYtd*FC.ratio*perfFactor);
            const ec=bgYtd>0?((rlYtd-bgYtd)/bgYtd*100):0;
            return{n:h.n,v:h.v,ch:h.ch,e:h.e,bgYtd,rlYtd,ecart:Math.round(ec*10)/10,
                st:Math.abs(ec)<=3?"Conforme":ec>3?"Surperformance":ec>-5?"Vigilance":"Alerte"};
        }).sort((a,b)=>a.ecart-b.ecart);
    },[]);
    const alertCount=ecarts.filter(e=>e.st==="Alerte").length;
    const vigCount=ecarts.filter(e=>e.st==="Vigilance").length;

    // --- Benchmarking enrichi (point mort, COSTPAR, ratio MS) ---
    const bench=useMemo(()=>{
        return H.map(h=>{
            const caCh=Math.round(h.ca*1000/h.ch);
            const gopCh=Math.round(h.ca*h.gp/100*1000/h.ch);
            const costpar=Math.round((h.ca*(100-h.gp)/100*1000)/(h.ch*365));
            const totalCosts=h.ca*(100-h.gp)/100;
            const fixedCosts=totalCosts*0.70;
            const revPerPt=h.adr*h.ch*365/100/1000;
            const varPerPt=totalCosts*0.30/h.to;
            const breakTO=Math.round(fixedCosts/(revPerPt-varPerPt));
            const baseMS=h.e<=2?46:h.e===3?40:34;
            const msCA=baseMS+((h.id*3+7)%8)-4;
            return{n:h.n,v:h.v,ch:h.ch,e:h.e,caCh,to:h.to,adr:h.adr,rp:h.rp,gopPct:h.gp,gopCh,costpar,breakTO,msCA};
        }).sort((a,b)=>b[benchTri]-a[benchTri]);
    },[benchTri]);

    const avg=k=>Math.round(bench.reduce((s,b)=>s+b[k],0)/bench.length);
    const avgCaCh=avg("caCh"),avgGopCh=avg("gopCh"),avgTo=avg("to");
    const avgRp=Math.round(bench.reduce((s,b)=>s+b.rp*10,0)/bench.length)/10;
    const avgCostpar=avg("costpar"),avgBreakTO=avg("breakTO"),avgMsCA=avg("msCA");

    // --- DSCR ---
    const gopHot=H.reduce((s,h)=>s+h.ca*h.gp/100,0);
    const dscrHot=gopHot/GRP.hot.remb;
    const dscrImmo=IMM.loyN/IMM.remb;
    const dscrCons=(gopHot+IMM.loyN)/GRP.cons.rembT;

    // --- BFR ---
    const bfr={crJ:18,stJ:5,foJ:42};
    const caJour=totalCA*1000/365;
    const bfrJ=bfr.crJ+bfr.stJ-bfr.foJ;
    const bfrK=Math.round(bfrJ*caJour/1000);

    // --- √âcarts Prix / Volume ---
    // Consolid√© N vs N-1 (PNL.conso TOTAL PRODUITS)
    const epv={caN:24740,caN1:19600,var:5140,prix:950,volume:1350,perimetre:2840};

    // --- Rolling Forecast ---
    const rfData=useMemo(()=>{
        return MCB.map((m,i)=>{
            if(i<=cm)return{m:m.m,reel:m.ca,bg:m.bg};
            const simpl=Math.round(m.bg*FC.ratio);
            const last3=MCB.slice(Math.max(0,cm-2),cm+1);
            const t3=last3.reduce((s,x)=>s+x.ca/x.bg,0)/last3.length;
            const roll=Math.round(m.bg*(t3*0.7+FC.ratio*0.3));
            return{m:m.m,bg:m.bg,simpl,roll};
        });
    },[]);
    const rfTot={s:rfData.reduce((s,d)=>s+(d.reel||d.simpl),0),r:rfData.reduce((s,d)=>s+(d.reel||d.roll),0),b:rfData.reduce((s,d)=>s+d.bg,0)};

    // --- CAPEX ---
    const capex=RDM.filter(r=>r.bud>100);
    const capexT=capex.reduce((s,r)=>s+r.bud,0);
    const capexD=capex.reduce((s,r)=>s+r.dep,0);

    // --- Simulation ---
    const sim=useMemo(()=>{
        const nCA=H.reduce((s,h)=>s+h.adr*h.ch*365*Math.min(98,Math.max(25,h.to+simTO))/100/1000,0);
        const dCA=nCA-totalCA;
        const ft=0.65;
        const dGOP=dCA*ft;
        const nGOP=gopHot+dGOP;
        const nDSCR=nGOP/GRP.hot.remb;
        const nMarge=nCA>0?(nGOP/nCA*100):0;
        return{nCA:Math.round(nCA),dCA:Math.round(dCA),nGOP:Math.round(nGOP),dGOP:Math.round(dGOP),nDSCR,nMarge:nMarge.toFixed(1),ft};
    },[simTO]);

    return(<div className="slide-enter space-y-6">
        {/* KPIs */}
        <div className="grid grid-cols-2 md:grid-cols-5 gap-4">
            <KPI label="Alertes (>5% √©cart)" value={alertCount} color={alertCount>0?"danger":"success"} icon={Ic.wrn}/>
            <KPI label="BFR" value={bfrJ+" jours"} color={bfrJ<0?"success":"warning"} trend={null}/>
            <KPI label="DSCR H√¥telier" value={dscrHot.toFixed(2)+"x"} color={dscrHot>=1.3?"success":dscrHot>=1?"warning":"danger"}/>
            <KPI label="DSCR Consolid√©" value={dscrCons.toFixed(2)+"x"} color={dscrCons>=1.3?"success":dscrCons>=1?"warning":"danger"}/>
            <KPI label="CAPEX engag√©" value={Math.round(capexD/capexT*100)+"%"} unit={"de "+fK(capexT)} color="primary"/>
        </div>

        {/* SIMULATION */}
        <div className="bg-white rounded-xl shadow-sm p-5 border-2 border-primary border-opacity-20">
            <Sec>Simulation de sensibilit√© ‚Äî Impact variation TO</Sec>
            <div className="flex items-center gap-4 mb-4">
                <span className="text-xs text-red-500 font-medium w-12 text-right">‚àí10 pts</span>
                <input type="range" min={-10} max={10} step={1} value={simTO} onChange={e=>setSimTO(Number(e.target.value))} className="sim-slider flex-1"/>
                <span className="text-xs text-green-600 font-medium w-12">+10 pts</span>
                <span className={"px-3 py-1 rounded-full text-sm font-bold "+(simTO===0?"bg-gray-100 text-gray-600":simTO>0?"bg-green-100 text-green-700":"bg-red-100 text-red-700")}>{simTO>0?"+":""}{simTO} pts TO</span>
            </div>
            <div className="grid grid-cols-2 md:grid-cols-5 gap-3 text-xs">
                <div className="p-3 rounded-xl bg-gray-50 text-center">
                    <span className="text-muted block mb-1">CA H√¥telier</span>
                    <span className="text-lg font-bold">{fK(sim.nCA)}</span>
                    <span className={"block text-[10px] font-medium "+(sim.dCA>=0?"text-green-600":"text-red-600")}>{sim.dCA>=0?"+":""}{fK(sim.dCA)}</span>
                </div>
                <div className="p-3 rounded-xl bg-gray-50 text-center">
                    <span className="text-muted block mb-1">GOP</span>
                    <span className="text-lg font-bold">{fK(sim.nGOP)}</span>
                    <span className={"block text-[10px] font-medium "+(sim.dGOP>=0?"text-green-600":"text-red-600")}>{sim.dGOP>=0?"+":""}{fK(sim.dGOP)}</span>
                </div>
                <div className="p-3 rounded-xl bg-gray-50 text-center">
                    <span className="text-muted block mb-1">Marge GOP</span>
                    <span className="text-lg font-bold">{sim.nMarge}%</span>
                </div>
                <div className="p-3 rounded-xl bg-gray-50 text-center">
                    <span className="text-muted block mb-1">DSCR</span>
                    <span className={"text-lg font-bold "+(sim.nDSCR>=1.3?"text-green-600":sim.nDSCR>=1?"text-orange-500":"text-red-600")}>{sim.nDSCR.toFixed(2)}x</span>
                </div>
                <div className="p-3 rounded-xl bg-blue-50 text-center">
                    <span className="text-muted block mb-1">Flow-through</span>
                    <span className="text-lg font-bold text-blue-700">{Math.round(sim.ft*100)}%</span>
                    <span className="block text-[10px] text-muted">du Œî CA ‚Üí GOP</span>
                </div>
            </div>
            <div className="mt-2 text-[10px] text-muted">Flow-through 65% : au-del√† du point mort, les charges fixes √©tant couvertes, 65% du CA additionnel se convertit en GOP.</div>
        </div>

        {/* √âcarts + Prix/Volume */}
        <div className="grid md:grid-cols-3 gap-6">
            <div className="md:col-span-2 bg-white rounded-xl shadow-sm p-5">
                <Sec right={<XBtn onClick={()=>xls(ecarts.map(e=>({Hotel:e.n,Ville:e.v,Budget_YTD:e.bgYtd,Reel_YTD:e.rlYtd,Ecart_pct:e.ecart,Statut:e.st})),"ecarts_budget")}/>}>√âcarts Budget vs R√©el ‚Äî YTD {MFR[cm]}</Sec>
                {alertCount>0&&<div className="p-2 bg-red-50 rounded-lg text-xs text-red-700 mb-3 flex items-center gap-2">{Ic.wrn} <strong>{alertCount}</strong> √©tablissement(s) en alerte (&gt;5%)</div>}
                <div className="overflow-x-auto"><table className="w-full text-xs">
                    <thead className="bg-gray-50"><tr>
                        <th className="p-2 text-left text-muted">√âtablissement</th>
                        <th className="p-2 text-right text-muted">Budget YTD</th>
                        <th className="p-2 text-right text-muted">R√©el YTD</th>
                        <th className="p-2 text-right text-muted">√âcart</th>
                        <th className="p-2 text-center text-muted">Statut</th>
                    </tr></thead>
                    <tbody>{ecarts.map(e=><tr key={e.n} className="border-t border-gray-100 hover:bg-gray-50">
                        <td className="p-2 font-medium">{e.n} <span className="text-[10px] text-muted">({e.v})</span></td>
                        <td className="p-2 text-right">{fK(e.bgYtd)}</td>
                        <td className="p-2 text-right">{fK(e.rlYtd)}</td>
                        <td className={"p-2 text-right font-bold "+(e.ecart>0?"text-green-600":e.ecart<-5?"text-red-600":"text-orange-500")}>{e.ecart>0?"+":""}{e.ecart}%</td>
                        <td className="p-2 text-center"><Bdg statut={e.st}/></td>
                    </tr>)}</tbody>
                </table></div>
            </div>
            <div className="bg-white rounded-xl shadow-sm p-5">
                <Sec>D√©composition CA N vs N-1</Sec>
                <div className="text-center mb-4">
                    <div className="text-2xl font-bold text-primary">+{fK(epv.var)}</div>
                    <div className="text-xs text-muted">{fK(epv.caN1)} ‚Üí {fK(epv.caN)} (+{((epv.var/epv.caN1)*100).toFixed(1)}%)</div>
                </div>
                <div className="space-y-3">
                    {[{l:"Effet prix (ADR)",v:epv.prix,c:"#10b981",ico:"üìà",pct:((epv.prix/epv.caN1)*100).toFixed(1)},
                      {l:"Effet volume (TO)",v:epv.volume,c:"#3b82f6",ico:"üìä",pct:((epv.volume/epv.caN1)*100).toFixed(1)},
                      {l:"Effet p√©rim√®tre",v:epv.perimetre,c:"#8b5cf6",ico:"üè®",pct:((epv.perimetre/epv.caN1)*100).toFixed(1)}
                    ].map(e=><div key={e.l} className="flex items-center gap-3">
                        <span className="text-sm">{e.ico}</span>
                        <div className="flex-1">
                            <div className="flex justify-between text-xs mb-0.5">
                                <span className="font-medium">{e.l}</span>
                                <span className="font-bold" style={{color:e.c}}>+{fK(e.v)} ({e.pct}%)</span>
                            </div>
                            <div className="w-full bg-gray-200 rounded-full h-2">
                                <div className="h-2 rounded-full" style={{width:(e.v/epv.var*100)+"%",background:e.c}}></div>
                            </div>
                        </div>
                    </div>)}
                </div>
                <div className="mt-3 p-2 bg-green-50 rounded-lg text-[10px] text-green-700">
                    <strong>Croissance organique : +{fK(epv.prix+epv.volume)}</strong> ({((epv.prix+epv.volume)/epv.caN1*100).toFixed(1)}%) ‚Äî Croissance √©quilibr√©e prix/volume, relais de croissance externe (+{fK(epv.perimetre)})
                </div>
            </div>
        </div>

        {/* Benchmarking enrichi */}
        <div className="bg-white rounded-xl shadow-sm p-5">
            <Sec right={<div className="flex gap-1 flex-wrap">
                {[{k:"caCh",l:"CA/ch."},{k:"gopCh",l:"GOP/ch."},{k:"to",l:"TO"},{k:"rp",l:"RevPAR"},{k:"breakTO",l:"Pt mort"},{k:"costpar",l:"COSTPAR"}].map(t=>
                    <button key={t.k} onClick={()=>setBenchTri(t.k)} className={"px-2 py-1 rounded text-[10px] font-medium "+(benchTri===t.k?"bg-primary text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200")}>{t.l}</button>
                )}
            </div>}>Benchmarking inter-√©tablissements</Sec>
            <div className="overflow-x-auto"><table className="w-full text-[11px]">
                <thead className="bg-gray-50"><tr>
                    <th className="p-1.5 text-left text-muted">√âtablissement</th>
                    <th className="p-1.5 text-center text-muted">‚òÖ</th>
                    <th className="p-1.5 text-right text-muted">CA/ch ‚Ç¨</th>
                    <th className="p-1.5 text-right text-muted">TO</th>
                    <th className="p-1.5 text-right text-muted">RevPAR</th>
                    <th className="p-1.5 text-right text-muted">GOP%</th>
                    <th className="p-1.5 text-right text-muted">GOP/ch ‚Ç¨</th>
                    <th className="p-1.5 text-right text-muted font-bold">COSTPAR ‚Ç¨</th>
                    <th className="p-1.5 text-right text-muted font-bold">Pt mort TO</th>
                    <th className="p-1.5 text-right text-muted font-bold">MS/CA</th>
                </tr></thead>
                <tbody>
                    {bench.map(b=>{const marg=b.to-b.breakTO;return<tr key={b.n} className="border-t border-gray-100 hover:bg-gray-50">
                        <td className="p-1.5 font-medium">{b.n}</td>
                        <td className="p-1.5 text-center text-yellow-500">{b.e}‚òÖ</td>
                        <td className={"p-1.5 text-right "+(b.caCh>=avgCaCh?"text-green-600":"text-red-500")}>{fmt(b.caCh)}</td>
                        <td className={"p-1.5 text-right "+(b.to>=avgTo?"text-green-600":"text-orange-500")}>{b.to}%</td>
                        <td className="p-1.5 text-right">{b.rp} ‚Ç¨</td>
                        <td className="p-1.5 text-right">{b.gopPct}%</td>
                        <td className={"p-1.5 text-right "+(b.gopCh>=avgGopCh?"text-green-600":"text-red-500")}>{fmt(b.gopCh)}</td>
                        <td className="p-1.5 text-right font-semibold">{b.costpar} ‚Ç¨</td>
                        <td className={"p-1.5 text-right font-semibold "+(marg>=20?"text-green-600":marg>=10?"text-blue-600":"text-orange-500")}>{b.breakTO}%</td>
                        <td className={"p-1.5 text-right "+(b.msCA<=avgMsCA?"text-green-600":"text-orange-500")}>{b.msCA}%</td>
                    </tr>})}
                    <tr className="border-t-2 border-gray-300 bg-gray-50 font-bold">
                        <td className="p-1.5" colSpan={2}>Moyenne</td>
                        <td className="p-1.5 text-right">{fmt(avgCaCh)}</td>
                        <td className="p-1.5 text-right">{avgTo}%</td>
                        <td className="p-1.5 text-right">{avgRp} ‚Ç¨</td>
                        <td className="p-1.5 text-right">‚Äî</td>
                        <td className="p-1.5 text-right">{fmt(avgGopCh)}</td>
                        <td className="p-1.5 text-right">{avgCostpar} ‚Ç¨</td>
                        <td className="p-1.5 text-right">{avgBreakTO}%</td>
                        <td className="p-1.5 text-right">{avgMsCA}%</td>
                    </tr>
                </tbody>
            </table></div>
            <div className="flex gap-2 mt-3 text-[10px]">
                <span className="px-2 py-0.5 bg-gray-100 rounded"><strong>COSTPAR</strong> = Charges totales / (chambres √ó 365)</span>
                <span className="px-2 py-0.5 bg-gray-100 rounded"><strong>Pt mort</strong> = TO minimum pour couvrir les charges fixes (70/30)</span>
                <span className="px-2 py-0.5 bg-gray-100 rounded"><strong>MS/CA</strong> = Masse salariale estim√©e / CA</span>
            </div>
        </div>

        {/* Rolling Forecast + DSCR + BFR */}
        <div className="grid md:grid-cols-3 gap-6">
            <div className="md:col-span-2 bg-white rounded-xl shadow-sm p-5">
                <Sec>Atterrissage glissant ‚Äî Rolling Forecast</Sec>
                <ResponsiveContainer width="100%" height={260}>
                    <ComposedChart data={rfData}><CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0"/>
                    <XAxis dataKey="m" tick={{fontSize:10}} stroke="#94a3b8"/>
                    <YAxis tick={{fontSize:10}} stroke="#94a3b8"/>
                    <Tooltip content={<CTip/>}/>
                    <Legend wrapperStyle={{fontSize:10}}/>
                    <Bar dataKey="reel" fill="#1e3a5f" name="R√©el" radius={[4,4,0,0]}/>
                    <Bar dataKey="simpl" fill="rgba(16,185,129,0.5)" name="Forecast simple" radius={[4,4,0,0]}/>
                    <Bar dataKey="roll" fill="rgba(139,92,246,0.5)" name="Rolling forecast" radius={[4,4,0,0]}/>
                    <Line type="monotone" dataKey="bg" stroke="#d4a853" name="Budget" strokeWidth={2} dot={false}/>
                    </ComposedChart>
                </ResponsiveContainer>
                <div className="grid grid-cols-3 gap-2 mt-2 text-xs">
                    <div className="p-2 bg-gray-50 rounded-lg text-center"><span className="text-muted block">Budget</span><strong>{fK(rfTot.b)}</strong></div>
                    <div className="p-2 bg-green-50 rounded-lg text-center"><span className="text-muted block">Forecast simple</span><strong className="text-green-700">{fK(rfTot.s)}</strong></div>
                    <div className="p-2 bg-purple-50 rounded-lg text-center"><span className="text-muted block">Rolling</span><strong className="text-purple-700">{fK(rfTot.r)}</strong></div>
                </div>
            </div>
            <div className="bg-white rounded-xl shadow-sm p-5 space-y-4">
                <Sec>DSCR & BFR</Sec>
                {[{l:"H√¥telier",v:dscrHot,gop:gopHot,remb:GRP.hot.remb},
                  {l:"Immobilier",v:dscrImmo,gop:IMM.loyN,remb:IMM.remb},
                  {l:"Consolid√©",v:dscrCons,gop:gopHot+IMM.loyN,remb:GRP.cons.rembT}
                ].map(d=><div key={d.l} className="p-2.5 border rounded-xl">
                    <div className="flex items-center justify-between mb-1">
                        <span className="text-xs font-semibold">{d.l}</span>
                        <span className={"text-base font-bold "+(d.v>=1.3?"text-green-600":d.v>=1?"text-orange-500":"text-red-600")}>{d.v.toFixed(2)}x</span>
                    </div>
                    <div className="w-full bg-gray-200 rounded-full h-2">
                        <div className={"h-2 rounded-full "+(d.v>=1.3?"bg-green-500":d.v>=1?"bg-orange-400":"bg-red-500")} style={{width:Math.min(d.v/2*100,100)+"%"}}></div>
                    </div>
                    <div className="flex justify-between text-[10px] text-muted mt-0.5">
                        <span>GOP {fK(Math.round(d.gop))}</span><span>Remb. {fK(d.remb)}/an</span>
                    </div>
                </div>)}
                <div className="p-3 border rounded-xl">
                    <div className="flex items-center justify-between mb-1">
                        <span className="text-xs font-semibold">BFR H√¥telier</span>
                        <span className={"text-base font-bold "+(bfrJ<0?"text-green-600":"text-orange-500")}>{bfrJ} jours</span>
                    </div>
                    <div className="grid grid-cols-3 gap-1 text-[10px]">
                        <div className="p-1.5 bg-orange-50 rounded text-center"><span className="text-muted block">Cr√©ances</span><strong>{bfr.crJ}j</strong></div>
                        <div className="p-1.5 bg-blue-50 rounded text-center"><span className="text-muted block">Stocks</span><strong>{bfr.stJ}j</strong></div>
                        <div className="p-1.5 bg-green-50 rounded text-center"><span className="text-muted block">Fournisseurs</span><strong>{bfr.foJ}j</strong></div>
                    </div>
                    <div className="mt-1 text-[10px] text-muted">BFR n√©gatif = le cycle d'exploitation s'autofinance ({fK(Math.abs(bfrK))} de tr√©sorerie g√©n√©r√©e)</div>
                </div>
            </div>
        </div>

        {/* CAPEX */}
        <div className="bg-white rounded-xl shadow-sm p-5">
            <Sec right={<span className="text-sm font-bold text-primary">{fmt(capexD)} / {fmt(capexT)} K‚Ç¨ ({Math.round(capexD/capexT*100)}%)</span>}>Suivi CAPEX & Investissements</Sec>
            <div className="space-y-2">{capex.map(r=><div key={r.id} className="border rounded-xl p-3">
                <div className="flex items-center justify-between mb-1">
                    <div><span className="text-sm font-semibold">{r.nom}</span><span className="text-[10px] text-muted ml-2">{r.typ} ¬∑ {r.resp}</span></div>
                    <Bdg statut={r.st}/>
                </div>
                <div className="flex items-center gap-3">
                    <div className="flex-1 bg-gray-200 rounded-full h-2.5">
                        <div className={"h-2.5 rounded-full progress-bar "+(r.prg>=75?"bg-green-500":r.prg>=30?"bg-blue-500":"bg-gray-400")} style={{width:r.prg+"%"}}></div>
                    </div>
                    <span className="text-xs font-bold w-10 text-right">{r.prg}%</span>
                </div>
                <div className="flex gap-4 text-[10px] text-muted mt-1">
                    <span>Budget {fK(r.bud)}</span><span>Engag√© {fK(r.dep)}</span><span>Reste {fK(r.bud-r.dep)}</span><span>√âch. {r.ech}</span>
                </div>
                {r.rsk&&<div className="mt-1 text-[10px] text-orange-600">{Ic.wrn} {r.rsk}</div>}
            </div>)}</div>
        </div>

        {/* Export */}
        <div className="flex justify-center gap-3 flex-wrap">
            <button onClick={()=>window.print()} className="flex items-center gap-2 px-5 py-2.5 bg-primary text-white rounded-xl text-xs font-semibold hover:bg-opacity-90 shadow-lg">{Ic.dl} Rapport CODIR (PDF)</button>
            <XBtn onClick={()=>xls([
                ...ecarts.map(e=>({Section:"√âcarts",Hotel:e.n,Ville:e.v,Budget_YTD:e.bgYtd,Reel_YTD:e.rlYtd,Ecart_pct:e.ecart,Statut:e.st})),
                ...bench.map(b=>({Section:"Benchmark",Hotel:b.n,Chambres:b.ch,CA_ch:b.caCh,TO:b.to,RevPAR:b.rp,GOP_pct:b.gopPct,GOP_ch:b.gopCh,COSTPAR:b.costpar,Pt_mort_TO:b.breakTO,MS_CA:b.msCA}))
            ],"pilotage_cdg")} label="Export Excel"/>
        </div>
    </div>);
};

// ===== APP COMPONENT =====
// ========== LOGIN PAGE ==========
const LoginPage=({onLogin})=>{
    const [email,setEmail]=useState("");
    const [password,setPassword]=useState("");
    const [error,setError]=useState("");
    const [loading,setLoading]=useState(false);

    const handleSubmit=(e)=>{
        e.preventDefault();
        setLoading(true);
        setError("");
        setTimeout(()=>{
            if(email==="jerome.scat@gmail.com" && password==="toto"){
                onLogin();
            }else{
                setError("Email ou mot de passe incorrect");
                setLoading(false);
            }
        },800);
    };

    return(
    <div className="min-h-screen flex items-center justify-center" style={{background:"linear-gradient(135deg,#1e3a5f 0%,#2d5a8e 100%)"}}>
        <div className="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md mx-4">
            <div className="text-center mb-8">
                <div className="w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center" style={{background:"#1e3a5f"}}>
                    <svg className="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                    </svg>
                </div>
                <h1 className="text-2xl font-bold" style={{color:"#1e3a5f"}}>Heintz Immobilier & H√¥tellerie</h1>
                <p className="text-gray-500 text-sm mt-1">Dashboard de Contr√¥le de Gestion</p>
            </div>
            <form onSubmit={handleSubmit} className="space-y-5">
                <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" value={email} onChange={e=>setEmail(e.target.value)} required
                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                        placeholder="votre@email.com"/>
                </div>
                <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">Mot de passe</label>
                    <input type="password" value={password} onChange={e=>setPassword(e.target.value)} required
                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/>
                </div>
                {error && <div className="text-red-500 text-sm text-center bg-red-50 py-2 rounded-lg">{error}</div>}
                <button type="submit" disabled={loading}
                    className="w-full py-3 rounded-lg font-semibold text-white transition disabled:opacity-70"
                    style={{background:loading?"#64748b":"#1e3a5f"}}>
                    {loading ? "Connexion..." : "Se connecter"}
                </button>
            </form>
            <div className="mt-6 pt-6 border-t border-gray-200 text-center">
                <p className="text-xs text-gray-400">Acc√®s r√©serv√© aux membres du CODIR</p>
            </div>
        </div>
    </div>);
};

const App=()=>{
    const [isLoggedIn,setIsLoggedIn]=useState(false);
    const [tab,setTab]=useState("synthese");
    const totalCH=H.reduce((s,h)=>s+h.ch,0);
    const totalCA=H.reduce((s,h)=>s+h.ca,0);
    const pages={synthese:SynthesePage,pnl:PnlCompletPage,tresorerie:TresoreriePage,pilotage:PilotagePage,immobilier:ImmobilierePage,etablissements:EtablissementsPage,budget:BudgetProjetsPage,rse:RsePage,organigramme:OrganigrammePage};
    const Page=pages[tab]||SynthesePage;

    if(!isLoggedIn) return <LoginPage onLogin={()=>setIsLoggedIn(true)}/>;

    return(
    <div className="min-h-screen bg-gray-50">
        <header className="gradient-header text-white py-4 no-print">
            <div className="max-w-7xl mx-auto px-4">
                <div className="flex items-center justify-between">
                    <div>
                        <h1 className="text-xl font-bold tracking-tight">Heintz Immobilier & H√¥tellerie</h1>
                        <p className="text-blue-200 text-xs mt-0.5">Dashboard de Contr√¥le de Gestion</p>
                    </div>
                    <div className="hidden sm:flex gap-5 text-xs">
                        <div className="text-center"><span className="block text-blue-200">H√¥tels</span><span className="text-lg font-bold">{H.length}</span></div>
                        <div className="text-center"><span className="block text-blue-200">Chambres</span><span className="text-lg font-bold">{fmt(totalCH)}</span></div>
                        <div className="text-center"><span className="block text-blue-200">CA H√¥telier</span><span className="text-lg font-bold">{fM(totalCA)}</span></div>
                        <div className="text-center"><span className="block text-blue-200">Patrimoine</span><span className="text-lg font-bold">{fM(IMM.val)}</span></div>
                    </div>
                </div>
            </div>
        </header>
        <Nav tab={tab} set={setTab}/>
        <main className="max-w-7xl mx-auto px-4 py-6"><Page/></main>
        <footer className="text-center py-4 text-xs text-muted no-print border-t border-gray-200 mt-8">
            Heintz Immobilier & H√¥tellerie ‚Äî Dashboard CDG ‚Äî Donn√©es plaquette 10/10/2025 ¬∑ {TODAY.toLocaleDateString('fr-FR')}
        </footer>
    </div>);
};

ReactDOM.render(<App/>, document.getElementById('root'));
</script>
</body>
</html>
